import{i as M,j as z}from"./chunk-MF7YEODA.js";M();z();function u(o){let n=0,e=0,r=0;for(let t=0;t<o.length;t++){let i=o[t];n+=i,t%2===0?r+=i:e+=i}return{length:n,includedLength:e,excludedLength:r}}function f(o,n,e){if(n<0)throw new RangeError("Negative length");if(n===0)return;if(!o.length)e?o.push(0,n):o.push(n);else{let r=o.length%2===0;e===r?o[o.length-1]+=n:o.push(n)}}function L(o,n){if(u(o).length!==u(n).length)throw new Error("Length mismatch");let e=[];for(let r=0,t=0,i=0,l=0,s=!0,h=!0;r<o.length||t<n.length;){if(i===0){if(r>=o.length)throw new Error("Length mismatch");i=o[r++],s=!s}if(l===0){if(t>=n.length)throw new Error("Size mismatch");l=n[t++],h=!h}i<l?(i&&e.push([i,s,h]),l=l-i,i=0):i>l?(l&&e.push([l,s,h]),i=i-l,l=0):(i&&e.push([i,s,h]),i=l=0)}return e}function v(o,n){let e=[];for(let[r,t,i]of L(o,n))f(e,r,t||i);return e}function R(o,n){let e=[];for(let[r,t,i]of L(o,n))f(e,r,t&&i);return e}function m(o,n){if(u(o).length!==u(n).length)throw new Error("Length mismatch");let e=[];for(let[r,t,i]of L(o,n))i||f(e,r,t);return e}function w(o,n){if(u(o).length!==u(n).excludedLength)throw new Error("Length mismatch");let e=[];for(let r=0,t=0,i=0,l=!0,s=!0;t<n.length;t++){let h=n[t];if(s=!s,s)f(e,h,!1);else for(;h;){i===0&&(i=o[r++],l=!l);let d=Math.min(i,h);f(e,d,l),i-=d,h-=d}}return e}function B(o,n){if(u(o).excludedLength!==u(n).excludedLength)throw new Error("Length mismatch");let e=[],r=[];for(let t=0,i=0,l=0,s=0,h=!0,d=!0;t<o.length||i<n.length;)if(l===0&&t<o.length&&(l=o[t++],h=!h),s===0&&i<n.length&&(s=n[i++],d=!d),h&&d)f(e,l,!0),f(e,s,!1),f(r,l,!1),f(r,s,!0),l=s=0;else if(h)f(e,l,!0),f(r,l,!1),l=0;else if(d)f(e,s,!1),f(r,s,!0),s=0;else{let c=Math.min(l,s);f(e,c,!1),f(r,c,!1),l-=c,s-=c}return[e,r]}var k=class o{constructor(n,e){this.parts=n,this.deleted=e}get inserted(){let n="";for(let e=0;e<this.parts.length;e++)typeof this.parts[e]=="string"&&(n+=this.parts[e]);return n}operations(){let n=[],e=!1,r=0,t=0;for(let i=0;i<this.parts.length;i++){let l=this.parts[i];if(typeof l=="number"){if(l<r)throw new TypeError("Malformed edit");if(l>r)if(e)n.push({type:"retain",start:r,end:l});else{let s=typeof this.deleted>"u"?void 0:this.deleted.slice(t,l);n.push({type:"delete",start:r,end:l,value:s}),t=l}r=l,e=!e}else n.push({type:"insert",start:r,value:l})}return n}apply(n){let e="",r=this.operations();for(let t=0;t<r.length;t++){let i=r[t];switch(i.type){case"retain":e+=n.slice(i.start,i.end);break;case"insert":e+=i.value;break}}return e}compose(n){let[e,r,t,i]=y(this),[l,s,h,d]=y(n);t=w(t,e),h=w(h,t),[t,l]=B(t,l),h=w(h,l),e=w(e,l);{let p=R(e,h);u(p).includedLength&&(t=m(t,p),r=C(e,r,p),e=m(e,p),h=m(h,p),l=m(l,p))}let c=v(e,l),a=x(e,r,l,s),g=m(v(t,h),c),N=i!=null&&d!=null?x(t,i,h,d):void 0;return S(c,a,g,N).normalize()}invert(){if(typeof this.deleted>"u")throw new Error("Edit is not invertible");let[n,e,r,t]=y(this);return r=w(r,n),n=m(n,r),S(r,t,n,e)}normalize(){if(typeof this.deleted>"u")throw new Error("Edit is not normalizable");let n=[],e=[],r="",t="",i,l=this.operations();for(let s=0;s<l.length;s++){let h=l[s];switch(h.type){case"insert":{i=h.value;break}case"retain":{i!==void 0&&(f(n,i.length,!0),r+=i,i=void 0),f(n,h.end-h.start,!1),f(e,h.end-h.start,!1);break}case"delete":{let d=h.end-h.start,c=h.value,a=0,g=0;i!==void 0&&(i===c?a=c.length:(a=I(i,c),g=E(i.slice(a),c.slice(a))),f(n,a,!1),f(n,i.length-a-g,!0),r+=i.slice(a,i.length-g)),t+=c.slice(a,c.length-g),f(e,a,!1),f(e,d-a-g,!0),f(e,g,!1),f(n,d-a-g,!1),f(n,g,!1),i=void 0;break}}}return i!==void 0&&(f(n,i.length,!0),r+=i),S(n,r,e,t)}hasChangesBetween(n,e){let r=this.operations();for(let t of r)switch(t.type){case"delete":{if(n<=t.start&&t.start<=e||n<=t.end&&t.end<=e)return!0;break}case"insert":{if(n<=t.start&&t.start<=e)return!0;break}}return!1}static builder(n){let e=0,r="",t,i=[],l=[];return{retain(s){return n!=null&&(s=Math.min(n.length-e,s)),e+=s,f(i,s,!1),f(l,s,!1),this},delete(s){return n!=null&&(s=Math.min(n.length-e,s),t=(t||"")+n.slice(e,e+s)),e+=s,f(i,s,!1),f(l,s,!0),this},insert(s){return f(i,s.length,!0),r+=s,this},concat(s){let h=s.operations();for(let d of h)switch(d.type){case"delete":this.delete(d.end-d.start);break;case"insert":this.insert(d.value);break;case"retain":this.retain(d.end-d.start);break}if(n!=null&&e>n.length)throw new RangeError("Edit is longer than original value");return this},build(){return n!=null&&(t=t||"",e<n.length&&(f(i,n.length-e,!1),f(l,n.length-e,!1))),S(i,r,l,t)}}}static diff(n,e,r){let t=I(n,e),i=E(n,e);return t+i>Math.min(n.length,e.length)&&(r!=null&&r>=0&&(t=Math.min(t,r)),i=E(n.slice(t),e.slice(t))),o.builder(n).retain(t).insert(e.slice(t,e.length-i)).delete(n.length-t-i).retain(i).build()}};function S(o,n,e,r){if(u(o).includedLength!==n.length)throw new Error("insertSeq and inserted string do not match in length");if(r!==void 0&&u(e).includedLength!==r.length)throw new Error("deleteSeq and deleted string do not match in length");let t=[],i=0,l=0,s=!0;for(let[h,d,c]of L(w(e,o),o))if(c){let a=n.slice(i,i+h);t.length&&typeof t[t.length-1]=="string"?t[t.length-1]+=a:t.push(a),i+=h}else d||t.push(l,l+h),l+=h,s=d;return s&&t.push(l),new k(t,r)}function y(o){let n=[],e=[],r="",t=o.operations();for(let i=0;i<t.length;i++){let l=t[i];switch(l.type){case"retain":{let s=l.end-l.start;f(n,s,!1),f(e,s,!1);break}case"delete":{let s=l.end-l.start;f(n,s,!1),f(e,s,!0);break}case"insert":f(n,l.value.length,!0),r+=l.value;break}}return[n,r,e,o.deleted]}function x(o,n,e,r){let t=0,i=0,l="";for(let[s,h,d]of L(o,e)){if(h&&d)throw new Error("Overlapping subseqs");h?(l+=n.slice(t,t+s),t+=s):d&&(l+=r.slice(i,i+s),i+=s)}return l}function C(o,n,e){let r=0,t="";for(let[i,l,s]of L(o,e))if(l)s||(t+=n.slice(r,r+i)),r+=i;else if(s)throw new Error("Non-overlapping subseqs");return t}function I(o,n){let e=0,r=Math.min(o.length,n.length),t=r;for(;e<t;)o.slice(e,t)===n.slice(e,t)?e=t:r=t,t=Math.floor((r-e)/2+e);return t}function E(o,n){let e=0,r=Math.min(o.length,n.length),t=r;for(;e<t;)o.slice(o.length-t,o.length-e)===n.slice(n.length-t,n.length-e)?e=t:r=t,t=Math.floor((r-e)/2+e);return t}export{k as a};
