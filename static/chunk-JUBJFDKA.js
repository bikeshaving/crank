function qe(e){return e!=null&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"&&typeof e.dispatchEvent=="function"}function M(e,n,t){Object.defineProperty(e,n,{value:t,writable:!1,configurable:!0})}function $e(e){return typeof e=="function"||e!==null&&typeof e=="object"&&typeof e.handleEvent=="function"}function Oe(e){return typeof e=="boolean"?{capture:e}:e??{}}var ne=Symbol.for("CustomEventTarget.parent"),q=Symbol.for("CustomEventTarget.listeners"),H=Symbol.for("CustomEventTarget.delegates"),ve=Symbol.for("CustomEventTarget.dispatchSelf"),x=class{constructor(n=null){this[ne]=n,this[q]=[],this[H]=new Set}addEventListener(n,t,i){if(!$e(t))return;let r=this[q];i=Oe(i);let o;typeof t=="function"?o=t:o=s=>t.handleEvent(s);let l={type:n,listener:t,callback:o,options:i};if(i.once&&(l.callback=function(){let s=r.indexOf(l);return s!==-1&&r.splice(s,1),o.apply(this,arguments)}),!r.some(s=>l.type===s.type&&l.listener===s.listener&&!l.options.capture==!s.options.capture)){r.push(l);for(let s of this[H])s.addEventListener(n,l.callback,l.options)}}removeEventListener(n,t,i){let r=this[q];if(r==null||!$e(t))return;let o=Oe(i),l=r.findIndex(f=>f.type===n&&f.listener===t&&!f.options.capture==!o.capture);if(l===-1)return;let s=r[l];r.splice(l,1);for(let f of this[H])f.removeEventListener(s.type,s.callback,s.options)}dispatchEvent(n){let t=[];for(let s=this[ne];s;s=s[ne])t.push(s);let i=!1,r=!1,o=n.stopPropagation;M(n,"stopPropagation",()=>(i=!0,o.call(n)));let l=n.stopImmediatePropagation;M(n,"stopImmediatePropagation",()=>(r=!0,l.call(n))),M(n,"target",this);try{M(n,"eventPhase",1);for(let s=t.length-1;s>=0;s--){let f=t[s],c=f[q];M(n,"currentTarget",f);for(let d=0;d<c.length;d++){let h=c[d];if(h.type===n.type&&h.options.capture){try{h.callback.call(f,n)}catch(g){console.error(g)}if(r)return!0}}if(i)return!0}{if(M(n,"eventPhase",2),M(n,"currentTarget",this),this[ve](n),r)return!0;let s=this[q];for(let f=0;f<s.length;f++){let c=s[f];if(c.type===n.type){try{c.callback.call(this,n)}catch(d){console.error(d)}if(r)return!0}}if(i)return!0}if(n.bubbles){M(n,"eventPhase",3);for(let s=0;s<t.length;s++){let f=t[s];M(n,"currentTarget",f);let c=f[q];for(let d=0;d<c.length;d++){let h=c[d];if(h.type===n.type&&!h.options.capture){try{h.callback.call(f,n)}catch(g){console.error(g)}if(r)return!0}}if(i)return!0}}}finally{return M(n,"eventPhase",0),M(n,"currentTarget",null),!n.defaultPrevented}}[ve](n){}};x.dispatchEventOnSelf=ve;function Ee(e,n,t=i=>e===i){let i=n.filter(qe);for(let r=e;r&&t(r);r=r[ne])for(let o=0;o<i.length;o++){let l=i[o];if(!r[H].has(l)){r[H].add(l);for(let s of r[q])l.addEventListener(s.type,s.callback,s.options)}}}function Ue(e,n,t=i=>e===i){let i=n.filter(qe);for(let r=e;r&&t(r);r=r[ne])for(let o=0;o<i.length;o++){let l=i[o];if(r[H].has(l)){r[H].delete(l);for(let s of r[q])l.removeEventListener(s.type,s.callback,s.options)}}}function Ce(e){let n=e[q],t=e[H];for(let i=0;i<n.length;i++){let r=n[i];for(let o of t)o.removeEventListener(r.type,r.callback,r.options)}n.length=0,t.clear()}function F(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function z(e){return e.length===0?void 0:e.length===1?e[0]:e}function He(e){return e==null?[]:Array.isArray(e)?e:typeof e=="string"||typeof e[Symbol.iterator]!="function"?[e]:[...e]}function Fe(e){return e!=null&&typeof e.next=="function"}function v(e){return e!=null&&typeof e.then=="function"}function un(e){let n=new Set,t={deferreds:n,settled:!1};return Promise.resolve(e).then(i=>{for(let{resolve:r}of n)r(i);n.clear(),t.settled=!0},i=>{for(let{reject:r}of n)r(i);n.clear(),t.settled=!0}),t}var Se=new WeakMap;function pe(e){let n;return new Promise((i,r)=>{n={resolve:i,reject:r};for(let o of e){if(!v(o)){Promise.resolve(o).then(i,r);continue}let l=Se.get(o);l===void 0?(l=un(o),l.deferreds.add(n),Se.set(o,l)):l.settled?Promise.resolve(o).then(i,r):l.deferreds.add(n)}}).finally(()=>{for(let i of e)if(v(i)){let r=Se.get(i);r&&r.deferreds.delete(n)}})}var O=()=>{};function S(e){return typeof e=="function"?e.name||"Anonymous":typeof e=="string"?e:e.description||"Anonymous"}var G="",j=Symbol.for("crank.Portal"),Ze=Symbol.for("crank.Copy"),re=Symbol.for("crank.Text"),Ie=Symbol.for("crank.Raw"),xe=Symbol.for("crank.Element"),le=class{constructor(n,t){this.tag=n,this.props=t}};le.prototype.$$typeof=xe;function en(e){return e!=null&&e.$$typeof===xe}var ze=["crank-","c-","$"],Ge=["key","ref","static","copy"];function ge(e,n,...t){n==null&&(n={}),"static"in n&&(console.error("The `static` prop is deprecated. Use `copy` instead."),n.copy=n.static,delete n.static);for(let i=0;i<ze.length;i++){let r=ze[i];for(let o=0;o<Ge.length;o++){let l=Ge[o],s=r+l;if(s in n){let f=l==="static"?"copy":l;console.error(`The \`${s}\` prop is deprecated. Use \`${f}\` instead.`),n[f]=n[s],delete n[s]}}}return t.length>1?n.children=t:t.length===1&&(n.children=t[0]),new le(e,n)}function dn(e){if(!en(e))throw new TypeError(`Cannot clone non-element: ${String(e)}`);return new le(e.tag,{...e.props})}function nn(e){if(!(typeof e=="boolean"||e==null)){{if(typeof e=="string"||en(e))return e;if(typeof e[Symbol.iterator]=="function")return ge(G,null,e)}return e.toString()}}var W=1,T=2,ye=4,se=8,P=16,ie=32,$=64,We=128,I=256,A=512,tn=1024,X=2048,J=4096,fe=8192,U=16384,D=32768,ee=65536,te=1<<17;function u(e,n){return!!(e.f&n)}function a(e,n,t=!0){t?e.f|=n:e.f&=~n}var Y=class{constructor(n){this.f=0,this.el=n,this.ctx=void 0,this.children=void 0,this.fallback=void 0,this.value=void 0,this.oldProps=void 0,this.pendingDiff=void 0,this.onNextDiff=void 0,this.graveyard=void 0,this.lingerers=void 0}};function cn(e){let n=new Y(e.el);return n.f=e.f,n.ctx=e.ctx,n.children=e.children,n.fallback=e.fallback,n.value=e.value,n.scope=e.scope,n.oldProps=e.oldProps,n.pendingDiff=e.pendingDiff,n.onNextDiff=e.onNextDiff,n.graveyard=e.graveyard,n.lingerers=e.lingerers,n}function b(e,n=!1,t){return u(e,$)&&n?e.fallback?b(e.fallback,n,t):void 0:e.fallback&&!u(e,W)?e.fallback?b(e.fallback,n,t):e.fallback:e.el.tag===j?void 0:e.el.tag===G||typeof e.el.tag=="function"?(t!=null&&e.ctx&&(e.ctx.index=t),z(B(e,t))):e.value}function B(e,n){let t=[],i=e.lingerers,r=F(e.children),o=n;for(let l=0;l<r.length;l++){if(i!=null&&i[l]!=null){let f=i[l];for(let c of f){let d=b(c,!0,o);if(Array.isArray(d)){for(let h=0;h<d.length;h++)t.push(d[h]);o!=null&&(o+=d.length)}else d&&(t.push(d),o!=null&&o++)}}let s=r[l];if(s){let f=b(s,!0,o);if(Array.isArray(f)){for(let c=0;c<f.length;c++)t.push(f[c]);o!=null&&(o+=f.length)}else f&&(t.push(f),o!=null&&o++)}}if(i!=null&&i.length>r.length)for(let l=r.length;l<i.length;l++){let s=i[l];if(s!=null)for(let f of s){let c=b(f,!0,o);if(Array.isArray(c)){for(let d=0;d<c.length;d++)t.push(c[d]);o!=null&&(o+=c.length)}else c&&(t.push(c),o!=null&&o++)}}return t}function Pe(e){let n,t;return{key:n,ref:n,copy:n,hydrate:n,children:n,...t}=e,t}var pn={create(){throw new Error("adapter must implement create")},adopt(){throw new Error("adapter must implement adopt() for hydration")},scope:({scope:e})=>e,read:e=>e,text:({value:e})=>e,raw:({value:e})=>e,patch:O,arrange:O,remove:O,finalize:O},Ke=class{constructor(n){this.cache=new WeakMap,this.adapter={...pn,...n}}render(n,t,i){let r=Ve(this,i,{children:n,root:t});return Xe(this.adapter,t,r,n)}hydrate(n,t,i){let r=Ve(this,i,{children:n,root:t,hydrate:!0});return Xe(this.adapter,t,r,n)}};function Ve(e,n,{children:t,root:i,hydrate:r}){let o,l=n&&n[R];typeof i=="object"&&i!==null&&(o=e.cache.get(i));let s=e.adapter;if(o===void 0)o=new Y(ge(j,{children:t,root:i,hydrate:r})),o.value=i,o.ctx=l,o.scope=s.scope({tag:j,tagName:S(j),props:Pe(o.el.props),scope:void 0,root:i}),typeof i=="object"&&i!==null&&t!=null&&e.cache.set(i,o);else{if(o.ctx!==l)throw new Error("A previous call to render() was passed a different context");o.el=ge(j,{children:t,root:i,hydrate:r}),typeof i=="object"&&i!==null&&t==null&&e.cache.delete(i)}return o}function Xe(e,n,t,i){let r=ke(e,n,t,t.ctx,t.scope,t,i),o=[];return v(r)?r.then(()=>(Ne(e,t,t,t.ctx,t.scope,n,0,o,void 0),o.length>0?Promise.all(o).then(()=>((typeof n!="object"||n===null)&&L(e,t,t.ctx,n,t,!1),e.read(z(B(t))))):((typeof n!="object"||n===null)&&L(e,t,t.ctx,n,t,!1),e.read(z(B(t)))))):(Ne(e,t,t,t.ctx,t.scope,n,0,o,void 0),o.length>0?Promise.all(o).then(()=>((typeof n!="object"||n===null)&&L(e,t,t.ctx,n,t,!1),e.read(z(B(t))))):((typeof n!="object"||n===null)&&L(e,t,t.ctx,n,t,!1),e.read(z(B(t)))))}function ke(e,n,t,i,r,o,l){let s=F(o.children),f=[],c=He(l),d=[],h,g,k=!1,E=0,C=s.length,y;for(let m=0,de=c.length;m<de;m++){let p=E>=C?void 0:s[E],w=nn(c[m]);{let _=typeof p=="object"?p.el.props.key:void 0,N=typeof w=="object"?w.props.key:void 0;if(N!==void 0&&g&&g.has(N)&&(console.error(`Duplicate key found in <${S(o.el.tag)}>`,N),w=dn(w),N=w.props.key=void 0),_===N)h!==void 0&&N!==void 0&&h.delete(N),E++;else if(h=h||hn(s,E),N===void 0){for(;p!==void 0&&_!==void 0;)E++,p=s[E],_=typeof p=="object"?p.el.props.key:void 0;E++}else p=h.get(N),p!==void 0&&h.delete(N),(g=g||new Set).add(N)}let Z;if(typeof w=="object"){let _=!1;if(w.tag===Ze)_=!0;else if(typeof p=="object"&&p.el===w&&u(p,T))_=!0;else{if(p&&p.el.tag===w.tag)p.el=w,w.props.copy&&typeof w.props.copy!="string"&&(_=!0);else if(p){let N=!1;for(let ce=p,K=p.fallback;K;ce=K,K=K.fallback)if(K.el.tag===w.tag){let Me=cn(K);a(Me,tn),ce.fallback=Me;let an=p;p=K,p.el=w,p.fallback=an,a(p,W,!1),N=!0;break}if(!N){let ce=p;p=new Y(w),p.fallback=ce}}else p=new Y(w);_&&u(p,T)||w.tag===Ie||w.tag===re||(w.tag===G?Z=ke(e,n,t,i,r,p,p.el.props.children):typeof w.tag=="function"?Z=sn(e,n,t,i,r,p):Z=gn(e,n,i,r,p))}typeof p=="object"&&(_?(a(p,ye),Z=rn(p)):a(p,ye,!1)),v(Z)&&(k=!0)}else typeof w=="string"?typeof p=="object"&&p.el.tag===re?p.el.props.value=w:(typeof p=="object"&&(y=y||[]).push(p),p=new Y(ge(re,{value:w}))):(typeof p=="object"&&(y=y||[]).push(p),p=void 0);d[m]=Z,f[m]=p}for(;E<C;E++){let m=s[E];typeof m=="object"&&(typeof m.el.props.key>"u"||!g||!g.has(m.el.props.key))&&(y=y||[]).push(m)}if(h!==void 0&&h.size>0){y=y||[];for(let m of h.values())y.push(m)}if(o.children=z(f),k){let m=Promise.all(d).then(()=>{}).finally(()=>{if(a(o,W),y)if(o.graveyard)for(let w=0;w<y.length;w++)o.graveyard.push(y[w]);else o.graveyard=y}),de,p=o.pendingDiff=pe([m,new Promise(w=>de=w)]);return o.onNextDiff&&o.onNextDiff(p),o.onNextDiff=de,p}else{if(a(o,W),y)if(o.graveyard)for(let m=0;m<y.length;m++)o.graveyard.push(y[m]);else o.graveyard=y;o.onNextDiff&&(o.onNextDiff(d),o.onNextDiff=void 0),o.pendingDiff=void 0}}function rn(e){if(e.ctx&&e.ctx.inflight)return e.ctx.inflight[1];if(e.pendingDiff)return e.pendingDiff}function hn(e,n){let t=new Map;for(let i=n;i<e.length;i++){let r=e[i];typeof r=="object"&&typeof r.el.props.key<"u"&&t.set(r.el.props.key,r)}return t}function gn(e,n,t,i,r){let o=r.el,l=o.tag;return o.tag===j&&(n=r.value=o.props.root),u(r,T)?i=r.scope:i=r.scope=e.scope({tag:l,tagName:S(l),props:o.props,scope:i,root:n}),ke(e,n,r,t,i,r,r.el.props.children)}function Ne(e,n,t,i,r,o,l,s,f){if(u(t,ye)&&u(t,T))return b(t);let c=t.el,d=c.tag;(typeof d=="function"||d===G||d===j||d===Ie||d===re)&&(typeof c.props.copy=="string"&&console.error(`String copy prop ignored for <${S(d)}>. Use booleans instead.`),typeof c.props.hydrate=="string"&&console.error(`String hydrate prop ignored for <${S(d)}>. Use booleans instead.`));let h,g;return f&&c.props.hydrate!=null&&!c.props.hydrate&&typeof c.props.hydrate!="string"&&(g=f,f=void 0),typeof d=="function"?(t.ctx.index=l,h=Q(t.ctx,s,f)):(d===G?h=Le(e,n,i,r,o,t,l,s,f):d===re?h=yn(e,t,c,r,f,o):d===Ie?h=mn(e,n,t,r,f,o):h=wn(e,t,i,o,s,f),t.fallback&&(L(e,n,i,o,t.fallback,!1),t.fallback=void 0)),g&&g.splice(0,F(h).length),u(t,T)||(a(t,T),typeof d!="function"&&d!==G&&d!==j&&typeof c.props.ref=="function"&&c.props.ref(e.read(h))),h}function Le(e,n,t,i,r,o,l,s,f){let c=[];for(let d=0,h=F(o.children);d<h.length;d++){let g=h[d],k,E=!1;for(;g&&(!u(g,W)&&g.fallback||u(g,$));){if(u(g,$)&&g.ctx.schedule&&((k=k||[]).push(g.ctx.schedule.promise),E=!0),!u(g,W)&&u(g,T))for(let C of B(g))e.remove({node:C,parentNode:n.value,isNested:!1,root:r});if(g=g.fallback,k&&E&&g){if(u(g,W))k=void 0;else{let C=rn(g);k.push(C)}u(g,We)?E=!0:(a(g,We,!0),E=!1)}}if(k&&k.length>1&&s.push(pe(k)),g){let C=Ne(e,n,g,t,i,r,l,s,f);if(Array.isArray(C)){for(let y=0;y<C.length;y++)c.push(C[y]);l+=C.length}else C&&(c.push(C),l++)}}if(o.graveyard){for(let d=0;d<o.graveyard.length;d++){let h=o.graveyard[d];L(e,n,t,r,h,!1)}o.graveyard=void 0}return o.lingerers&&(c=B(o)),c}function yn(e,n,t,i,r,o){let l=e.text({value:t.props.value,scope:i,oldNode:n.value,hydrationNodes:r,root:o});return n.value=l,l}function mn(e,n,t,i,r,o){if(!t.oldProps||t.oldProps.value!==t.el.props.value){let l=F(t.value);for(let s=0;s<l.length;s++){let f=l[s];e.remove({node:f,parentNode:n.value,isNested:!1,root:o})}t.value=e.raw({value:t.el.props.value,scope:i,hydrationNodes:r,root:o})}return t.oldProps=Pe(t.el.props),t.value}function wn(e,n,t,i,r,o){if(u(n,ye)&&u(n,T))return b(n);let l=n.el.tag,s=Pe(n.el.props),f=n.oldProps,c=n.value,d,h=!1;if(f){for(let y in s)s[y]===Ze&&(s[y]=f[y],(d=d||new Set).add(y));if(typeof n.el.props.copy=="string"){let y=new me("copy",n.el.props.copy);if(y.include)for(let m of y.props)m in f&&(s[m]=f[m],(d=d||new Set).add(m));else for(let m in f)y.props.has(m)||(s[m]=f[m],(d=d||new Set).add(m));h=y.includes("children")}}let g=n.scope,k,E,C;if(!u(n,T))if(l===j){if(n.el.props.hydrate&&typeof n.el.props.hydrate!="string"&&(k=e.adopt({tag:l,tagName:S(l),node:c,props:s,scope:g,root:i}),k))for(let y=0;y<k.length;y++)e.remove({node:k[y],parentNode:c,isNested:!1,root:i})}else{if(!c&&o){let y=o.shift();if(typeof n.el.props.hydrate=="string")if(C=new me("hydration",n.el.props.hydrate),C.include){E=new Set(Object.keys(s));for(let m of C.props)E.delete(m)}else E=C.props;if(k=e.adopt({tag:l,tagName:S(l),node:y,props:s,scope:g,root:i}),k){c=y;for(let m=0;m<k.length;m++)e.remove({node:k[m],parentNode:c,isNested:!1,root:i})}}c||(c=e.create({tag:l,tagName:S(l),props:s,scope:g,root:i})),n.value=c}if(l!==j&&e.patch({tag:l,tagName:S(l),node:c,props:s,oldProps:f,scope:g,root:i,copyProps:d,isHydrating:!!k,quietProps:E}),!h){let y=Le(e,n,t,g,l===j?c:i,n,0,r,C&&!C.includes("children")?void 0:k);e.arrange({tag:l,tagName:S(l),node:c,props:s,children:y,oldProps:f,root:i})}if(n.oldProps=s,l===j){ln(e,n.value);return}return c}var me=class{constructor(n,t){this.include=!0,this.props=new Set;let i=!0,r=!0,o=t.split(/[,\s]+/);for(let l=0;l<o.length;l++){let s=o[l].trim();if(s)s.startsWith("!")?(i=!1,this.props.add(s.slice(1))):(r=!1,this.props.add(s));else continue}!r&&!i?(console.error(`Invalid ${n} prop "${t}".
Use prop or !prop but not both.`),this.include=!0,this.props.clear()):this.include=i}includes(n){return this.include?this.props.has(n):!this.props.has(n)}};function bn(e,n){for(let t=n;t!==void 0;t=t.parent)if(t===e)return!0;return!1}var on={};function ln(e,n,t){n!=null&&e.finalize(n),(typeof n!="object"||n===null)&&(n=on);let i=oe.get(n);if(i){let r=new Map;for(let[o,l]of i)(u(o.ret,$)||t&&!bn(t,o))&&(i.delete(o),r.set(o,l));r.size?oe.set(n,r):oe.delete(n);for(let[o,l]of i){let s=e.read(b(o.ret));for(let f of l)f(s)}}}function L(e,n,t,i,r,o){if(r.fallback&&(L(e,n,t,i,r.fallback,o),r.fallback=void 0),!u(r,tn)){if(r.lingerers){for(let l=0;l<r.lingerers.length;l++){let s=r.lingerers[l];if(s)for(let f of s)L(e,n,t,i,f,o)}r.lingerers=void 0}typeof r.el.tag=="function"?kn(r.ctx,o):r.el.tag===G?he(e,n,t,i,r,o):r.el.tag===j?(he(e,r,t,r.value,r,!1),r.value!=null&&e.finalize(r.value)):(he(e,r,t,i,r,!0),u(r,T)&&(t&&Ue(t.ctx,[r.value],l=>l[R].host===n),e.remove({node:r.value,parentNode:n.value,isNested:o,root:i})))}}function he(e,n,t,i,r,o){if(r.graveyard){for(let l=0;l<r.graveyard.length;l++){let s=r.graveyard[l];L(e,n,t,i,s,o)}r.graveyard=void 0}for(let l=0,s=F(r.children);l<s.length;l++){let f=s[l];typeof f=="object"&&L(e,n,t,i,f,o)}}var Re=new WeakMap,we=new WeakMap,be=new WeakMap,oe=new WeakMap,je=class{constructor(n,t,i,r,o,l){this.adapter=n,this.root=t,this.host=i,this.parent=r,this.ctx=new De(this),this.scope=o,this.ret=l,this.iterator=void 0,this.inflight=void 0,this.enqueued=void 0,this.onPropsProvided=void 0,this.onPropsRequested=void 0,this.pull=void 0,this.index=0,this.schedule=void 0}},R=Symbol.for("crank.ContextState"),De=class extends x{constructor(n){super(n.parent?n.parent.ctx:null),this[R]=n}get props(){return this[R].ret.el.props}get value(){return console.warn("Context.value is deprecated."),this[R].adapter.read(b(this[R].ret))}get isExecuting(){return u(this[R].ret,P)}get isUnmounted(){return u(this[R].ret,I)}*[Symbol.iterator](){let n=this[R];a(n.ret,fe);try{for(;!u(n.ret,I)&&!u(n.ret,A);){if(u(n.ret,D))throw new Error(`<${S(n.ret.el.tag)}> context iterated twice without a yield`);a(n.ret,D),yield n.ret.el.props}}finally{a(n.ret,fe,!1)}}async*[Symbol.asyncIterator](){let n=this[R];a(n.ret,U);try{for(;!u(n.ret,I)&&!u(n.ret,A);){if(u(n.ret,D))throw new Error(`<${S(n.ret.el.tag)}> context iterated twice without a yield`);if(a(n.ret,D),u(n.ret,ee))a(n.ret,ee,!1),yield n.ret.el.props;else{let t=await new Promise(i=>n.onPropsProvided=i);if(u(n.ret,I)||u(n.ret,A))break;yield t}n.onPropsRequested&&(n.onPropsRequested(),n.onPropsRequested=void 0)}}finally{a(n.ret,U,!1),n.onPropsRequested&&(n.onPropsRequested(),n.onPropsRequested=void 0)}}refresh(n){let t=this[R];if(u(t.ret,I))return console.error(`Component <${S(t.ret.el.tag)}> is unmounted. Check the isUnmounted property if necessary.`),t.adapter.read(b(t.ret));if(u(t.ret,P))return console.error(`Component <${S(t.ret.el.tag)}> is already executing Check the isExecuting property if necessary.`),t.adapter.read(b(t.ret));if(n){let o=n();if(v(o))return Promise.resolve(o).then(()=>u(t.ret,I)?t.adapter.read(b(t.ret)):this.refresh())}u(t.ret,$)&&a(t.ret,te);let i,r=[];try{if(a(t.ret,ie),i=fn(t),v(i))return i.then(()=>t.adapter.read(Q(t,r))).then(l=>r.length?Promise.all(r).then(()=>t.adapter.read(b(t.ret))):l).catch(l=>{let s=ue(t,l,r);return s?s.then(()=>r.length?Promise.all(r).then(()=>t.adapter.read(b(t.ret))):t.adapter.read(b(t.ret))):r.length?Promise.all(r).then(()=>t.adapter.read(b(t.ret))):t.adapter.read(b(t.ret))}).finally(()=>a(t.ret,ie,!1));let o=t.adapter.read(Q(t,r));return r.length?Promise.all(r).then(()=>t.adapter.read(b(t.ret))):o}catch(o){let l=ue(t,o,r);return l?l.then(()=>{if(r.length)return Promise.all(r).then(()=>t.adapter.read(b(t.ret)))}).then(()=>t.adapter.read(b(t.ret))):r.length?Promise.all(r).then(()=>t.adapter.read(b(t.ret))):t.adapter.read(b(t.ret))}finally{v(i)||a(t.ret,ie,!1)}}schedule(n){if(!n)return new Promise(r=>this.schedule(r));let t=this[R],i=we.get(t);i||(i=new Set,we.set(t,i)),i.add(n)}after(n){if(!n)return new Promise(l=>this.after(l));let t=this[R],i=t.root||on,r=oe.get(i);r||(r=new Map,oe.set(i,r));let o=r.get(t);o||(o=new Set,r.set(t,o)),o.add(n)}flush(n){console.error("Context.flush() method has been renamed to after()"),this.after(n)}cleanup(n){if(!n)return new Promise(r=>this.cleanup(r));let t=this[R];if(u(t.ret,I)){let r=t.adapter.read(b(t.ret));n(r);return}let i=be.get(t);i||(i=new Set,be.set(t,i)),i.add(n)}consume(n){for(let t=this[R].parent;t!==void 0;t=t.parent){let i=Re.get(t);if(i&&i.has(n))return i.get(n)}}provide(n,t){let i=this[R],r=Re.get(i);r||(r=new Map,Re.set(i,r)),r.set(n,t)}[x.dispatchEventOnSelf](n){let t=this[R],i=t.ret.el.props["on"+n.type];if(typeof i=="function")i(n);else for(let r in t.ret.el.props)r.toLowerCase()==="on"+n.type.toLowerCase()&&(i=t.ret.el.props[r],typeof i=="function"&&i(n))}};function sn(e,n,t,i,r,o){let l;if(o.ctx){if(l=o.ctx,u(l.ret,P)){console.error(`Component <${S(l.ret.el.tag)}> is already executing`);return}else if(l.schedule)return l.schedule.promise.then(()=>sn(e,n,t,i,r,o))}else l=o.ctx=new je(e,n,t,i,r,o);return a(l.ret,se),fn(l)}function V(e,n,t){if(u(e.ret,I)||u(e.ret,A))return;n===void 0&&console.error(`Component <${S(e.ret.el.tag)}> has ${t?"yielded":"returned"} undefined. If this was intentional, ${t?"yield":"return"} null instead.`);let i;try{a(e.ret,P),i=ke(e.adapter,e.root,e.host,e,e.scope,e.ret,nn(n)),i&&(i=i.catch(r=>Te(e,r)))}catch(r){i=Te(e,r)}finally{a(e.ret,P,!1)}return i}function fn(e){if(e.inflight){if(!e.enqueued){let n;e.enqueued=[new Promise(t=>n=t).finally(()=>Ye(e)),e.inflight[0].finally(()=>{let[t,i]=Je(e);return n(t),i})]}}else{let[n,t]=Je(e);return n&&(e.inflight=[n.finally(()=>Ye(e)),t]),t}return e.enqueued[1]}function Ye(e){e.inflight=e.enqueued,e.enqueued=void 0}function Je(e){if(u(e.ret,I))return[void 0,void 0];let n=e.ret,t=!e.iterator;if(t){a(e.ret,P),Ce(e.ctx);let r;try{r=n.el.tag.call(e.ctx,n.el.props,e.ctx)}catch(o){throw a(e.ret,A),o}finally{a(e.ret,P,!1)}if(Fe(r))e.iterator=r;else if(v(r)){let o=r instanceof Promise?r:Promise.resolve(r);return[o.catch(O),o.then(l=>V(e,l,!1),l=>{throw a(e.ret,A),l})]}else return[void 0,V(e,r,!1)]}let i;if(t){try{a(e.ret,P),i=e.iterator.next()}catch(r){throw a(e.ret,A),r}finally{a(e.ret,P,!1)}v(i)?a(e.ret,J):a(e.ret,X)}if(u(e.ret,X)){if(!t)try{a(e.ret,P);let l=e.adapter.read(b(e.ret));i=e.iterator.next(l)}catch(l){throw a(e.ret,A),l}finally{a(e.ret,P,!1)}if(v(i))throw new Error("Mixed generator component");u(e.ret,fe)&&!u(e.ret,D)&&!u(e.ret,I)&&!u(e.ret,te)&&console.error(`Component <${S(e.ret.el.tag)}> yielded/returned more than once in for...of loop`),a(e.ret,D,!1),a(e.ret,te,!1),i.done&&(a(e.ret,X,!1),e.iterator=void 0);let r=V(e,i.value,!i.done);return[v(r)?r.catch(O):void 0,r]}else{if(u(e.ret,U))return Qe(e,i),[ae(e),e.pull&&e.pull.diff];{if(ae(e),!t)try{a(e.ret,P);let o=e.adapter.read(b(e.ret));i=e.iterator.next(o)}catch(o){throw a(e.ret,A),o}finally{a(e.ret,P,!1)}if(!v(i))throw new Error("Mixed generator component");let r=i.then(o=>(u(e.ret,U)?Qe(e,o):u(e.ret,fe)&&!u(e.ret,D)&&!u(e.ret,I)&&!u(e.ret,te)&&console.error(`Component <${S(e.ret.el.tag)}> yielded/returned more than once in for...of loop`),a(e.ret,D,!1),a(e.ret,te,!1),o.done&&(a(e.ret,J,!1),e.iterator=void 0),V(e,o.value,!o.done)),o=>{throw a(e.ret,A),o});return[r.catch(O),r]}}}function ae(e){if(e.onPropsProvided)e.onPropsProvided(e.ret.el.props),e.onPropsProvided=void 0,a(e.ret,ee,!1);else if(a(e.ret,ee),u(e.ret,U))return new Promise(n=>e.onPropsRequested=n);return e.pull&&e.pull.iterationP&&e.pull.iterationP.then(O,O)}async function Qe(e,n){if(!n||e.pull)return;e.pull={iterationP:void 0,diff:void 0,onChildError:void 0};let t=!1;try{let i;for(;!t;){v(n)&&(e.pull.iterationP=n);let r;e.pull.diff=new Promise(f=>r=f).then(()=>{u(e.ret,se)||u(e.ret,ie)||Q(e,[])},f=>{if(!(u(e.ret,se)||u(e.ret,ie))||!u(e.ret,D))return ue(e,f,[]);throw f});let o;try{o=await n}catch(f){t=!0,a(e.ret,A),a(e.ret,D,!1),r(Promise.reject(f));break}let l;{let f=!0,c=new Promise((d,h)=>{e.ctx.schedule(d),e.pull.onChildError=g=>{if(h(g),f)return i=g,ae(e),e.pull.diff}});c.catch(O),l=Object.create(c),l.then=function(d,h){return f=!1,c.then(d,h)},l.catch=function(d){return f=!1,c.catch(d)}}if(i!=null)try{if(a(e.ret,P),typeof e.iterator.throw!="function")throw i;o=await e.iterator.throw(i)}catch(f){t=!0,a(e.ret,A),a(e.ret,D,!1),r(Promise.reject(f));break}finally{i=void 0,a(e.ret,P,!1)}u(e.ret,U)||a(e.ret,ee,!1),t=!!o.done;let s;try{v(n)?!u(e.ret,D)&&u(e.ret,ee)&&u(e.ret,U)?s=void 0:s=V(e,o.value,!o.done):s=void 0}catch(f){r(Promise.reject(f))}finally{r(s),a(e.ret,D,!1)}if(u(e.ret,I)){for(;(!o||!o.done)&&e.iterator&&u(e.ret,U);)try{a(e.ret,P),o=await e.iterator.next(l)}catch(f){throw a(e.ret,A),f}finally{a(e.ret,P,!1)}if((!o||!o.done)&&e.iterator&&typeof e.iterator.return=="function")try{a(e.ret,P),await e.iterator.return()}catch(f){throw a(e.ret,A),f}finally{a(e.ret,P,!1)}break}else if(u(e.ret,U)){if(!o.done)try{a(e.ret,P),n=e.iterator.next(l)}finally{a(e.ret,P,!1)}}else break}}finally{t&&(a(e.ret,J,!1),e.iterator=void 0),e.pull=void 0}}function Q(e,n,t){if(e.schedule)return e.schedule.promise.then(()=>{Q(e,[]),Ae(e)}),b(e.ret);let i=Le(e.adapter,e.host,e,e.scope,e.root,e.ret,e.index,n,t);if(u(e.ret,I))return;Ee(e.ctx,i);let r=u(e.ret,$),o,l=we.get(e);if(l){we.delete(e),a(e.ret,$);let s=e.adapter.read(z(i));for(let f of l){let c=f(s);v(c)&&(o=o||[]).push(c)}if(o&&!u(e.ret,T)){let f=Promise.all(o).then(()=>{a(e.ret,$,r),Ae(e),e.ret.fallback&&L(e.adapter,e.host,e.parent,e.root,e.ret.fallback,!1),e.ret.fallback=void 0}),c,d=pe([f,new Promise(h=>c=h)]).finally(()=>{e.schedule=void 0});e.schedule={promise:d,onAbort:c},n.push(d)}else a(e.ret,$,r)}else a(e.ret,$,r);return u(e.ret,$)||(u(e.ret,se)||Ae(e),e.ret.fallback&&L(e.adapter,e.host,e.parent,e.root,e.ret.fallback,!1),e.ret.fallback=void 0,a(e.ret,se,!1)),a(e.ret,T),b(e.ret,!0)}function Pn(e,n){let t=[n];for(;t.length>0;){let i=t.pop();if(i===e)return!0;let r=i!==n&&(typeof i.el.tag=="string"&&i.el.tag!==G||i.el.tag===j);if(i.children&&!r){let o=F(i.children);for(let l of o)l&&t.push(l)}i.fallback&&!u(i,W)&&t.push(i.fallback)}return!1}function Ae(e){let n=B(e.ret,e.index);Ee(e.ctx,n,l=>l[R].host===e.host);let t=e.host,i=e.ret;if(!Pn(i,t)||!u(t,T))return;let r=Pe(t.el.props),o=B(t,0);e.adapter.arrange({tag:t.el.tag,tagName:S(t.el.tag),node:t.value,props:r,oldProps:r,children:o,root:e.root}),ln(e.adapter,e.root,e)}async function kn(e,n){if(u(e.ret,I))return;let t,i=be.get(e);if(i){let o=e.adapter.read(b(e.ret));be.delete(e);for(let l of i){let s=l(o);v(s)&&(t=t||[]).push(s)}}let r=!1;if(!n&&t&&B(e.ret).length>0){r=!0;let o=e.index,l=e.host.lingerers||(e.host.lingerers=[]),s=l[o];s==null&&(s=new Set,l[o]=s),s.add(e.ret),await Promise.all(t),s.delete(e.ret),s.size===0&&(l[o]=void 0),l.some(Boolean)||(e.host.lingerers=void 0)}if(!u(e.ret,I)&&(a(e.ret,I),e.schedule&&(e.schedule.onAbort(),e.schedule=void 0),Ce(e.ctx),he(e.adapter,e.host,e,e.root,e.ret,n),r&&e.root!=null&&e.adapter.finalize(e.root),e.iterator)){if(e.pull){ae(e);return}e.inflight&&await e.inflight[1];let o;if(u(e.ret,fe))try{a(e.ret,P);let l=e.adapter.read(b(e.ret)),s=e.iterator.next(l);if(v(s)){if(!u(e.ret,J))throw new Error("Mixed generator component");o=await s}else{if(!u(e.ret,X))throw new Error("Mixed generator component");o=s}}catch(l){throw a(e.ret,A),l}finally{a(e.ret,P,!1)}if((!o||!o.done)&&e.iterator&&typeof e.iterator.return=="function")try{a(e.ret,P);let l=e.iterator.return();if(v(l)){if(!u(e.ret,J))throw new Error("Mixed generator component");o=await l}else{if(!u(e.ret,X))throw new Error("Mixed generator component");o=l}}catch(l){throw a(e.ret,A),l}finally{a(e.ret,P,!1)}}}function Te(e,n){if(!e.iterator)throw n;if(e.pull)return e.pull.onChildError(n),e.pull.diff;if(!e.iterator.throw)throw n;ae(e);let t;try{a(e.ret,P),t=e.iterator.throw(n)}catch(i){throw a(e.ret,A),i}finally{a(e.ret,P,!1)}return v(t)?t.then(i=>(i.done&&(a(e.ret,X,!1),a(e.ret,J,!1),e.iterator=void 0),V(e,i.value,!i.done)),i=>{throw a(e.ret,A),i}):(t.done&&(a(e.ret,X,!1),a(e.ret,J,!1),e.iterator=void 0),V(e,t.value,!t.done))}function ue(e,n,t){let i=e.parent;if(!i)throw n;let r;try{r=Te(i,n)}catch(o){return ue(i,o,t)}if(v(r))return r.then(()=>{Q(i,t)},o=>ue(i,o,t));Q(i,t)}export{G as a,j as b,Ze as c,re as d,Ie as e,le as f,en as g,ge as h,dn as i,Ke as j,De as k};
