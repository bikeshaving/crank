<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Crank.js | Components</title><link href="/static/index-UEEVTAOK.css" rel="stylesheet" type="text/css"><link rel="shortcut icon" href="/static/favicon.ico"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-20910936-4"></script><script>
								window.dataLayer = window.dataLayer || [];
								function gtag(){dataLayer.push(arguments);}
								gtag('js', new Date());

								gtag('config', 'UA-20910936-4');
							</script></head><body><nav id="navbar" class="navbar"><div class="navbar-group"><div class="navbar-item"><a class="navbar-title-link false" href="/"><img class="navbar-logo" src="/static/logo.svg" alt=""><span>Crank.js</span></a></div><div class="navbar-item"><a class="current" href="/guides/getting-started">Docs</a></div><div class="navbar-item"><a href="/blog/">Blog</a></div></div><div class="navbar-group"><div class="navbar-item"><a href="https://github.com/bikeshaving/crank">GitHub</a></div><div class="navbar-item"><a href="http://npm.im/@bikeshaving/crank">NPM</a></div></div></nav><div class="non-footer"><div id="sidebar" class="sidebar"><h3>Guides</h3><div class="sidebar-item"><a href="/guides/getting-started" class="">Getting Started</a></div><div class="sidebar-item"><a href="/guides/elements" class="">JSX, Elements and Renderers</a></div><div class="sidebar-item"><a href="/guides/components" class="current">Components</a></div><div class="sidebar-item"><a href="/guides/handling-events" class="">Handling Events</a></div><div class="sidebar-item"><a href="/guides/async-components" class="">Async Components</a></div><div class="sidebar-item"><a href="/guides/special-props-and-tags" class="">Special Props and Tags</a></div><div class="sidebar-item"><a href="/guides/lifecycles" class="">Lifecycles</a></div><div class="sidebar-item"><a href="/guides/reusable-logic" class="">Reusable Logic</a></div><div class="sidebar-item"><a href="/guides/working-with-typescript" class="">Working with TypeScript</a></div><div class="sidebar-item"><a href="/guides/reference-for-react-developers" class="">Reference for React Developers</a></div><div class="sidebar-item"><a href="/guides/api-reference" class="">API Reference</a></div></div><main class="main"><div class="content"><h1>Components</h1><p>So far, we’ve only seen and used host elements, but eventually, we’ll want to group parts of the element tree into reusable <em>components.</em> In Crank, all components are functions; there is no class-based component API.</p><h2>Basic Components</h2><p>The simplest kind of component is a <em>function component</em>. When rendered, the function is invoked with the props of the element as its first argument, and the return value of the function is recursively rendered as the element’s children.</p><div class="codeblock" data-code="import {createElement} from &quot;https://unpkg.com/@b9g/crank/crank&quot;;
import {renderer} from &quot;https://unpkg.com/@b9g/crank/dom&quot;;
function Greeting({name}) {
  return &lt;div&gt;Hello, {name}&lt;/div&gt;;
}

renderer.render(&lt;Greeting name=&quot;World&quot; /&gt;, document.body);" data-lang="jsx live"><div class="playground"><content-area><pre class="editable editable-live" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createElement<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/crank&quot;</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>World<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div><p>Component elements can be passed children just as host elements can. The <code class="inline">createElement</code> function will add children to the props object under the name <code class="inline">children</code>, and it is up to the component to place these children somewhere in the returned element tree. If you don’t use the <code class="inline">children</code> prop, it will not appear in the rendered output.</p><div class="codeblock" data-code="import {createElement} from &quot;https://unpkg.com/@b9g/crank/crank&quot;;
import {renderer} from &quot;https://unpkg.com/@b9g/crank/dom&quot;;

function Greeting({name, children}) {
  return (
    &lt;div&gt;
      Message for {name}: {children}
    &lt;/div&gt;
  );
}

renderer.render(
  &lt;Greeting name=&quot;Nemo&quot;&gt;
    &lt;span&gt;Howdy!&lt;/span&gt;
  &lt;/Greeting&gt;,
  document.body,
);" data-lang="jsx live"><div class="playground"><content-area><pre class="editable editable-live" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createElement<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/crank&quot;</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">,</span> children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token punctuation">(</span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      Message <span class="token keyword">for</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span>children<span class="token punctuation">}</span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>  <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Nemo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>Howdy<span class="token operator">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Greeting</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div><h2>Stateful Components</h2><p>Eventually, you’ll want to write components with local state. In Crank, we use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*">generator functions</a> to do so. These types of components are referred to as <em>generator components</em>.</p><div class="codeblock" data-code="function *Counter() {
  let count = 0;
  while (true) {
    count++;
    yield (
      &lt;div&gt;
        You have updated this component {count} {count === 1 ? &quot;time&quot; : &quot;times&quot;}
      &lt;/div&gt;
    );
  }
}

renderer.render(&lt;Counter /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;You have updated this component 1 time&lt;/div&gt;&quot;
renderer.render(&lt;Counter /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;You have updated this component 2 times&lt;/div&gt;&quot;
renderer.render(&lt;Counter /&gt;, document.body);
renderer.render(&lt;Counter /&gt;, document.body);
renderer.render(&lt;Counter /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;You have updated this component 5 times&lt;/div&gt;&quot;
renderer.render(null, document.body);
console.log(document.body.innerHTML);
// &quot;&quot;
renderer.render(&lt;Counter /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;You have updated this component 1 time&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        You have updated <span class="token keyword">this</span> component <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token punctuation">{</span>count <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;time&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;times&quot;</span><span class="token punctuation">}</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;You have updated this component 1 time&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;You have updated this component 2 times&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;You have updated this component 5 times&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;You have updated this component 1 time&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>By yielding elements rather than returning them, we can make components stateful using variables in the generator’s local scope. Crank uses the same diffing algorithm which reuses DOM nodes to reuse generator objects, so that their executions are preserved between renders. Every time a generator component is rendered, Crank resumes the generator and executes the generator until the next <code class="inline">yield</code>. The yielded expression, usually an element, is then rendered as the element’s children, just as if it were returned from a function component.</p><h3>Contexts</h3><p>In the preceding example, the <code class="inline">Counter</code> component’s local state changed when it was rerendered, but we may want to write components which update themselves according to timers or events instead. Crank allows components to control their own execution by passing in an object called a <em>context</em> as the <code class="inline">this</code> keyword of each component. Contexts provide several utility methods, most important of which is the <code class="inline">refresh</code> method, which tells Crank to update the related component instance in place.</p><div class="codeblock" data-code="function *Timer() {
  let seconds = 0;
  const interval = setInterval(() =&gt; {
    seconds++;
    this.refresh();
  }, 1000);

  try {
    while (true) {
      yield (
        &lt;div&gt;Seconds elapsed: {seconds}&lt;/div&gt;
      );
    }
  } finally {
    clearInterval(interval);
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> seconds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    seconds<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Seconds elapsed<span class="token operator">:</span> <span class="token punctuation">{</span>seconds<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>This <code class="inline">Timer</code> component is similar to the <code class="inline">Counter</code> one, except now the state (the local variable <code class="inline">seconds</code>) is updated in the callback passed to <code class="inline">setInterval</code>, rather than when the component is rerendered. Additionally, the <code class="inline">refresh</code> method is called to ensure that the generator is stepped through whenever the <code class="inline">setInterval</code> callback fires, so that the rendered DOM actually reflects the updated <code class="inline">seconds</code> variable.</p><p>One important detail about the <code class="inline">Timer</code> example is that it cleans up after itself with <code class="inline">clearInterval</code> in the <code class="inline">finally</code> block. Crank will call the <code class="inline">return</code> method on an element’s related generator object when it is unmounted.</p><h3>Props Updates</h3><p>The generator components we’ve seen so far haven’t used props. Generator components can accept props as their first parameter just like regular function components.</p><div class="codeblock" data-code="function *LabeledCounter({message}) {
  let count = 0;
  while (true) {
    count++;
    yield &lt;div&gt;{message} {count}&lt;/div&gt;;
  }
}

renderer.render(
  &lt;LabeledCounter message=&quot;The count is now:&quot; /&gt;,
  document.body,
);

console.log(document.body.innerHTML); // &quot;&lt;div&gt;The count is now: 1&lt;/div&gt;&quot;

renderer.render(
  &lt;LabeledCounter message=&quot;The count is now:&quot; /&gt;,
  document.body,
);

console.log(document.body.innerHTML); // &quot;&lt;div&gt;The count is now: 2&lt;/div&gt;&quot;

renderer.render(
  &lt;LabeledCounter message=&quot;Le décompte est maintenant:&quot; /&gt;,
  document.body,
);

// WOOPS!
console.log(document.body.innerHTML); // &quot;&lt;div&gt;The count is now: 3&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">LabeledCounter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LabeledCounter</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The count is now:<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;The count is now: 1&lt;/div&gt;&quot;</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LabeledCounter</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The count is now:<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;The count is now: 2&lt;/div&gt;&quot;</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LabeledCounter</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Le décompte est maintenant:<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code><span class="token comment">// WOOPS!</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;The count is now: 3&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>This mostly works, except we have a bug where the component keeps yielding elements with the initial message even though a new message was passed in via props. We can make sure props are kept up to date by iterating over the context:</p><div class="codeblock" data-code="function *Counter({message}) {
  let count = 0;
  for ({message} of this) {
    count++;
    yield (
      &lt;div&gt;{message} {count}&lt;/div&gt;
    );
  }
}

renderer.render(
  &lt;Counter message=&quot;The count is now:&quot; /&gt;,
  document.body,
);

console.log(document.body.innerHTML); // &quot;&lt;div&gt;The count is now: 1&lt;/div&gt;&quot;

renderer.render(
  &lt;Counter message=&quot;Le décompte est maintenant:&quot; /&gt;,
  document.body,
);

console.log(document.body.innerHTML); // &quot;&lt;div&gt;Le décompte est maintenant: 2&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Counter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The count is now:<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;The count is now: 1&lt;/div&gt;&quot;</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span></code><br></div><div><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Le décompte est maintenant:<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span></code><br></div><div><code>  document<span class="token punctuation">.</span>body<span class="token punctuation">,</span></code><br></div><div><code><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Le décompte est maintenant: 2&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>By replacing the <code class="inline">while</code> loop with a <code class="inline">for…of</code> loop which iterates over <code class="inline">this</code>, you can get the latest props each time the generator is resumed. This is possible because contexts are an iterable of the latest props passed to components.</p><h3>Comparing Old and New Props</h3><p>One Crank idiom we see in the preceding example is that we overwrite the variables declared via the generator’s parameters with the destructuring expression in the <code class="inline">for…of</code> statement. This is an easy way to make sure those variables stay in sync with the current props of the component. However, there is no requirement that you must always overwrite old props in the <code class="inline">for</code> expression, meaning you can assign new props to a different variable and compare them against the old props.</p><div class="codeblock" data-code="import {createElement} from &quot;https://unpkg.com/@b9g/crank/crank&quot;;
import {renderer} from &quot;https://unpkg.com/@b9g/crank/dom&quot;;

function *Greeting({name}) {
  yield &lt;div&gt;Hello {name}.&lt;/div&gt;;
  for (const {name: newName} of this) {
    if (name === newName) {
      yield (
        &lt;div&gt;Hello again {newName}.&lt;/div&gt;
      );
    } else {
      yield (
        &lt;div&gt;Goodbye {name} and hello {newName}.&lt;/div&gt;
      );
    }

    name = newName;
  }
}

function *App() {
  let i = 0;
  for ({} of this) {
    const name = (Math.floor(i++ / 2) % 2) === 0 ? &quot;Alice&quot; : &quot;Bob&quot;;
    yield (
      &lt;div&gt;
        &lt;Greeting name={name} /&gt;
        &lt;button onclick={() =&gt; this.refresh()}&gt;Rerender&lt;/button&gt;
      &lt;/div&gt;
    );
  }
}

renderer.render(&lt;App /&gt;, document.body);" data-lang="jsx live"><div class="playground"><content-area><pre class="editable editable-live" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>createElement<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/crank&quot;</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;https://unpkg.com/@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> newName<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> newName<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello again <span class="token punctuation">{</span>newName<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Goodbye <span class="token punctuation">{</span>name<span class="token punctuation">}</span> and hello <span class="token punctuation">{</span>newName<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>    name <span class="token operator">=</span> newName<span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>i<span class="token operator">++</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">&quot;Alice&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token attr-name">name</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span>Rerender<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div><p>The fact that state is just local variables allows us to blur the lines between props and state, in a way that is easy to understand and without lifecycle methods like <code class="inline">componentWillUpdate</code> from React. With generators and <code class="inline">for</code> loops, comparing old and new props is as easy as comparing adjacent elements of an array.</p><h2>Default Props</h2><p>You may have noticed in the preceding examples that we used <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Object_destructuring">object destructuring</a> on the props parameter for convenience. You can further assign default values to specific props by using JavaScript’s default value syntax.</p><div class="codeblock" data-code="function Greeting({name=&quot;World&quot;}) {
  return &lt;div&gt;Hello, {name}&lt;/div&gt;;
}

renderer.render(&lt;Greeting /&gt;, document.body); // &quot;&lt;div&gt;Hello World&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Greeting</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Hello World&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>This syntax works well for function components, but for generator components, you should make sure that you use the same default value in both the parameter list and the <code class="inline">for</code> statement.</p><div class="codeblock" data-code="function *Greeting({name=&quot;World&quot;}) {
  yield &lt;div&gt;Hello, {name}&lt;/div&gt;;
  for ({name=&quot;World&quot;} of this) {
    yield &lt;div&gt;Hello again, {name}&lt;/div&gt;;
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Greeting</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">&quot;World&quot;</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Hello again<span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>A mismatch in the default values for a prop between these two positions may cause surprising behavior.</p></div></main></div><script src="/static/index-FZKVRLRI.js"></script></body></html>