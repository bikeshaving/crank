<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Crank.js | Lifecycles</title><link href="/static/index-UEEVTAOK.css" rel="stylesheet" type="text/css"><link rel="shortcut icon" href="/static/favicon.ico"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-20910936-4"></script><script>
								window.dataLayer = window.dataLayer || [];
								function gtag(){dataLayer.push(arguments);}
								gtag('js', new Date());

								gtag('config', 'UA-20910936-4');
							</script></head><body><nav id="navbar" class="navbar"><div class="navbar-group"><div class="navbar-item"><a class="navbar-title-link false" href="/"><img class="navbar-logo" src="/static/logo.svg" alt=""><span>Crank.js</span></a></div><div class="navbar-item"><a class="current" href="/guides/getting-started">Docs</a></div><div class="navbar-item"><a href="/blog/">Blog</a></div></div><div class="navbar-group"><div class="navbar-item"><a href="https://github.com/bikeshaving/crank">GitHub</a></div><div class="navbar-item"><a href="http://npm.im/@bikeshaving/crank">NPM</a></div></div></nav><div class="non-footer"><div id="sidebar" class="sidebar"><h3>Guides</h3><div class="sidebar-item"><a href="/guides/getting-started" class="">Getting Started</a></div><div class="sidebar-item"><a href="/guides/elements" class="">JSX, Elements and Renderers</a></div><div class="sidebar-item"><a href="/guides/components" class="">Components</a></div><div class="sidebar-item"><a href="/guides/handling-events" class="">Handling Events</a></div><div class="sidebar-item"><a href="/guides/async-components" class="">Async Components</a></div><div class="sidebar-item"><a href="/guides/special-props-and-tags" class="">Special Props and Tags</a></div><div class="sidebar-item"><a href="/guides/lifecycles" class="current">Lifecycles</a></div><div class="sidebar-item"><a href="/guides/reusable-logic" class="">Reusable Logic</a></div><div class="sidebar-item"><a href="/guides/working-with-typescript" class="">Working with TypeScript</a></div><div class="sidebar-item"><a href="/guides/reference-for-react-developers" class="">Reference for React Developers</a></div><div class="sidebar-item"><a href="/guides/api-reference" class="">API Reference</a></div></div><main class="main"><div class="content"><h1>Lifecycles</h1><p>Crank uses generator functions rather than hooks or classes to define component lifecycles. Internally, this is achieved by calling the <code class="inline">next</code>, <code class="inline">return</code> and <code class="inline">throw</code> methods of the returned generator object as components are mounted, updated and unmounted from the element tree. As a developer, you can use the <code class="inline">yield</code>, <code class="inline">return</code>, <code class="inline">try</code>, <code class="inline">catch</code>, and <code class="inline">finally</code> keywords within your generator components to take full advantage of the generator’s natural lifecycle.</p><h2>Returning Values</h2><p>In most generator components, you will yield children within a loop so that they can continue to respond to updates. However, you may also want to return a final state. Unlike function components, which are called and returned once for each update, once a generator component returns, its rendered value is final, and the component will never update again.</p><div class="codeblock" data-code="function *Stuck({message}) {
  return &lt;div&gt;{message}&lt;/div&gt;;
}

renderer.render(&lt;Stuck message=&quot;Hello&quot; /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;
renderer.render(&lt;Stuck message=&quot;Goodbye&quot; /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;
renderer.render(&lt;Stuck message=&quot;Passing in new props is useless&quot; /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Stuck</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Stuck</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Hello<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Stuck</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Goodbye<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Stuck</span></span> <span class="token attr-name">message</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Passing in new props is useless<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Hello&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>You should be careful when writing generator components to make sure that you always place your <code class="inline">yield</code> operators in a <code class="inline">for</code> or <code class="inline">while</code> loop. If you forget and implicitly return from the generator, it will stop updating and nothing will be rendered ever again.</p><div class="codeblock" data-code="function *Numbers() {
  yield 1;
  yield 2;
  yield 3;
}

renderer.render(&lt;Numbers /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;1&quot;
renderer.render(&lt;Numbers /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;2&quot;
renderer.render(&lt;Numbers /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;3&quot;
renderer.render(&lt;Numbers /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&quot;
renderer.render(&lt;Numbers /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Numbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">yield</span> <span class="token number">1</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">yield</span> <span class="token number">2</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">yield</span> <span class="token number">3</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Numbers</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;1&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Numbers</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;2&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Numbers</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;3&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Numbers</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Numbers</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span></code><br></div></pre></content-area></div></div><h2>Cleaning Up</h2><p>When a generator component is removed from the tree, Crank calls the <code class="inline">return</code> method on the component’s generator object. You can think of it as whatever <code class="inline">yield</code> expression your component was suspended on being replaced by a <code class="inline">return</code> statement. This means any loops your component was in when the generator suspended are broken out of, and code after the yield does not execute.</p><p>You can take advantage of this behavior by wrapping your <code class="inline">yield</code> loops in a <code class="inline">try</code>/<code class="inline">finally</code> block to release any resources that your component may have used.</p><div class="codeblock" data-code="function *Cleanup() {
  try {
    while (true) {
      yield &quot;Hi&quot;;
    }
  } finally {
    console.log(&quot;finally block executed&quot;);
  }
}

renderer.render(&lt;Cleanup /&gt;, document.body);
console.log(document.body); // &quot;Hi&quot;
renderer.render(null, document.body);
// &quot;finally block executed&quot;
console.log(document.body); // &quot;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token string">&quot;Hi&quot;</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></code><br></div><div><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;finally block executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Cleanup</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hi&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;finally block executed&quot;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span></code><br></div></pre></content-area></div></div><p><a href="https://eslint.org/docs/rules/no-unsafe-finally">The same best practices</a> which apply to <code class="inline">try</code>/<code class="inline">finally</code> statements in regular functions apply to generator components. In short, you should not yield or return anything in the <code class="inline">finally</code> block. Crank will not use the yielded or returned values and doing so might cause your components to inadvertently swallow errors or suspend in unexpected locations.</p><h2>Catching Errors</h2><p>We all make mistakes, and it can be useful to catch errors thrown by our components so that we can show the user something or notify error-logging services. To facilitate this, Crank will catch errors thrown when rendering child elements and throw them back into parent generator components using the <code class="inline">throw</code> method on the component’s generator object. You can think of it as whatever <code class="inline">yield</code> expression your component was suspended on being replaced with a <code class="inline">throw</code> statement with the error set to whatever was thrown by the component’s children.</p><p>You can take advantage of this behavior by wrapping your <code class="inline">yield</code> operations in a <code class="inline">try</code>/<code class="inline">catch</code> block to catch errors caused by children.</p><div class="codeblock" data-code="function Thrower() { 
  throw new Error(&quot;Hmmm&quot;);
}

function *Catcher() {
  try {
    yield &lt;Thrower /&gt;;
  } catch (err) {
    return &lt;div&gt;Error: {err.message}&lt;/div&gt;;
  }
}

renderer.render(&lt;Catcher /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&lt;div&gt;Error: Hmmm&lt;/div&gt;&quot;
renderer.render(&lt;Catcher /&gt;, document.body);
renderer.render(&lt;Catcher /&gt;, document.body);
renderer.render(&lt;Catcher /&gt;, document.body);
console.log(document.body.innerHTML); // &quot;&lt;div&gt;Error: Hmmm&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token function">Thrower</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </code><br></div><div><code>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Hmmm&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Catcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Thrower</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Error<span class="token operator">:</span> <span class="token punctuation">{</span>err<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Catcher</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Error: Hmmm&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Catcher</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Catcher</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Catcher</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&lt;div&gt;Error: Hmmm&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><p>As explained previously, this component “sticks” because it uses a return statement, so that the same error message is shown until the component is unmounted. However, you may also want to recover from errors as well, and you can do this by ignoring or handling the error.</p><div class="codeblock" data-code="function T1000() { 
  throw new Error(&quot;Die!!!&quot;);
}

function *Terminator() {
  while (true) {
    yield &lt;div&gt;Come with me if you want to live&lt;/div&gt;;
    try {
      yield &lt;T1000 /&gt;;
    } catch (err) {
      yield &lt;div&gt;I’ll be back&lt;/div&gt;;
    }
  }
}

renderer.render(&lt;Terminator /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;Come with me if you want to live&lt;/div&gt;&quot;
renderer.render(&lt;Terminator /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;I’ll be back&lt;/div&gt;&quot;
renderer.render(&lt;Terminator /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;Come with me if you want to live&lt;/div&gt;&quot;
renderer.render(&lt;Terminator /&gt;, document.body);
console.log(document.body.innerHTML);
// &quot;&lt;div&gt;I’ll be back&lt;/div&gt;&quot;" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token constant">T1000</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </code><br></div><div><code>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Die!!!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Terminator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Come <span class="token keyword">with</span> me <span class="token keyword">if</span> you want to live<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">T1000</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token constant">I</span>’ll be back<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Terminator</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;Come with me if you want to live&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Terminator</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;I’ll be back&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Terminator</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;Come with me if you want to live&lt;/div&gt;&quot;</span></code><br></div><div><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Terminator</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token comment">// &quot;&lt;div&gt;I’ll be back&lt;/div&gt;&quot;</span></code><br></div></pre></content-area></div></div><h2>Accessing Rendered Values</h2><p>Sometimes, declarative rendering is not enough, and you’ll want to access the actual DOM nodes you’ve rendered, to make measurements or call imperative methods like the <code class="inline">focus</code> method for form elements, or the <code class="inline">play</code> method for media elements. To facilitate this, Crank will pass rendered DOM nodes back into the generator using the <code class="inline">next</code> method. This means that as a developer, you can read <code class="inline">yield</code> expressions to access the actual rendered DOM nodes.</p><div class="codeblock" data-code="async function *FocusingInput(props) {
  for await (props of this) {
    const input = yield &lt;input {...props}/&gt;;
    input.focus();
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">FocusingInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>    input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>The <code class="inline">FocusingInput</code> component focuses every time it is rerendered. We use an async generator component here because async generators continuously resume, so the <code class="inline">input.focus</code> call happens directly after the component is rendered. While we also pass rendered nodes into sync generator components as well, attempting to access them directly after the <code class="inline">yield</code> may lead to surprising results.</p><div class="codeblock" data-code="function *FocusingInput(props) {
  for (props of this) {
    const input = yield &lt;input {...props}/&gt;;
    // This line does not execute until the component is rerendered.
    input.focus();
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">FocusingInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token comment">// This line does not execute until the component is rerendered.</span></code><br></div><div><code>    input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>The problem is that sync generator components suspend at the point of yield expressions and only resume when updated by the parent or by a call to the <code class="inline">refresh</code> method. This means that if you were to try to access the rendered value via a <code class="inline">yield</code> expression, your code would not execute until the moment the component rerenders. You can imagine this as the generator function above suspended exactly before the <code class="inline">yield</code> expression is assigned to the <code class="inline">input</code> variable.</p><p>To solve this problem, Crank provides an additional method on the context called <code class="inline">schedule</code>, which takes a callback and calls it with the rendered value after the component executes.</p><div class="codeblock" data-code="function *FocusingInput(props) {
  for (props of this) {
    this.schedule((input) =&gt; input.focus());
    yield &lt;input {...props}/&gt;;
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">FocusingInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span><span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>The <code class="inline">schedule</code> method fires the passed in callback synchronously when component finally renders. However, one unfortunate consequence of using a callback is that we lose the sequential execution of code which makes generator components so elegant and easy to understand. We can recover some of this linearity by using the <code class="inline">schedule</code> method with the <code class="inline">refresh</code> method.</p><div class="codeblock" data-code="function *FocusingInput(props) {
  this.schedule(() =&gt; this.refresh());
  const input = yield &lt;input {...props} /&gt;;
  for (props of this) {
    input.focus();
    yield &lt;input {...props} /&gt;;
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">FocusingInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>The focusing input now focuses before the children are yielded, but because the same input is yielded, the result is mostly the same. The <code class="inline">schedule</code> method is designed to work with the <code class="inline">refresh</code> method so that sync generator components can schedule multiple rendering passes which work synchronously.</p></div></main></div><script src="/static/index-FZKVRLRI.js"></script></body></html>