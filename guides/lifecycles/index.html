<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Crank.js | Lifecycles</title><link rel="shortcut icon" href="/static/favicon.ico"><style>.css-1l1hcps{position:fixed;top:0;left:0;right:0;height:50px;z-index:999;gap:1em;}.css-1n0j5y9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:1em;}.css-1xmwt0h{border-bottom:1px solid var(--text-color);overflow-x:auto;background-color:inherit;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;gap:1em;}.css-1xmwt0h a{-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}@media screen and (min-width: 800px){.css-1xmwt0h{padding:0 2em;}}.css-1cvb758{max-width:calc(100% - 1px);}.css-1m42aok{overflow-x:auto;max-width:100%;}.css-artqa7{position:relative;min-height:100%;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}.css-84ojsb{display:contents;}.css-1ashatc{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;word-break:break-all;overflow-wrap:anywhere;line-break:anywhere;white-space:pre-wrap;white-space:break-spaces;font-size:16px;}.css-1flouoi{border-bottom:1px dotted #333;}.color-scheme-light .css-1flouoi{border-bottom:1px dotted #ddd;}.css-1nius9d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}.css-14pt8ki{-webkit-flex:none;-ms-flex:none;flex:none;padding:1em;height:3em;border-bottom:1px solid var(--text-color);}.css-j74n8p{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;padding:1em;-webkit-transition:background-color 0.4s ease-out;transition:background-color 0.4s ease-out;background-color:var(--coldark02);width:100%;}.css-hjkbgb{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;border:none;width:100%;background-color:var(--bg-color);}.css-1mkiuoh{margin:0 auto;padding:2rem 0.4rem;}@media screen and (min-width: 800px){.css-1mkiuoh{margin-left:240px;padding:2rem 1rem;margin-top:50px;}}@media screen and (min-width: 1100px){.css-1mkiuoh{margin-left:20rem;padding:3rem 2rem;}}.css-1mkiuoh p{max-width:800px;}.css-1vm8pxc{max-width:min(100%, 1000px);}.css-1s1lac9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;font-size:16px;}@media (min-width: 1300px){.css-1s1lac9{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}.css-18sfz2f{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;width:100%;border:1px solid var(--text-color);margin-top:-1px;margin-right:-1px;}.css-by286k{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;width:100%;border:1px solid var(--text-color);margin-top:-1px;margin-right:-1px;}@media (min-width: 1300px){.css-by286k{max-width:61.8%;}}.css-nuifz8{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:-webkit-sticky;position:sticky;top:100px;border:1px solid var(--text-color);margin-top:-1px;min-height:50px;width:100%;}@media screen and (min-width: 1300px){.css-nuifz8{width:30%;}}.css-w1ljn4{margin:10px 0;}.css-1l0nd7p{-webkit-text-decoration:none;text-decoration:none;}.css-1wkb9s8{background-color:var(--bg-color);margin-top:50px;padding:2rem 0.4rem;color:var(--text-color);border-right:1px solid currentcolor;border-bottom:1px solid currentcolor;}@media screen and (min-width: 800px){.css-1wkb9s8{position:fixed;top:50px;bottom:0;overflow-x:hidden;overflow-y:auto;width:15rem;margin:0;padding:2rem 1rem;text-align:right;}}@media screen and (min-width: 1100px){.css-1wkb9s8{padding:3rem 2rem;width:20rem;}}.css-1wkb9s8 &gt;:first-child{margin-top:0;}.css-ep9szm{color:var(--highlight-color);margin-top:0;}</style><link href="/static/client-SW6MAMAL.css" rel="stylesheet" type="text/css"><meta name="description" content="Master component lifecycles in Crank using generator functions. Learn cleanup patterns, resource management, and how to handle component unmounting naturally."><meta property="og:title" content="Crank.js | Lifecycles"><meta property="og:url" content="https:/crank.js.org/guides/lifecycles"><meta property="og:description" content="Master component lifecycles in Crank using generator functions. Learn cleanup patterns, resource management, and how to handle component unmounting naturally."><meta property="og:type" content="website"><meta property="og:site_name" content="Crank.js"><meta property="og:image" content="https://crank.js.org/static/logo.svg"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Crank.js | Lifecycles"><meta name="twitter:description" content="Master component lifecycles in Crank using generator functions. Learn cleanup patterns, resource management, and how to handle component unmounting naturally."><meta name="twitter:image" content="https://crank.js.org/static/logo.svg"></head><body><script>
	(() => {
		const colorScheme = sessionStorage.getItem("color-scheme") ||
			(window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches
				? "dark" : "light"
			);
		if (colorScheme === "dark") {
			document.body.classList.remove("color-scheme-light");
		} else {
			document.body.classList.add("color-scheme-light");
		}
	})()</script><div id="navbar-root"><nav class="
				blur-background
				css-1l1hcps
				css-1xmwt0h
			"><div class="css-1n0j5y9"><div><a class="css-1n0j5y9" style="gap: 0.3em" href="/"><svg style="flex: none;" fill="none" viewBox="-200 -200 400 400" width="1.9em" height="1.9em" xmlns="http://www.w3.org/2000/svg"><defs><mask id="wedge-mask"><rect x="-200" y="-200" width="400" height="400" fill="white"></rect><path stroke="none" fill="black" d="
							M 0 0
							L 245.74561328669753 172.07293090531383
							L 245.74561328669753 -172.07293090531383
							z
						"></path></mask></defs><g stroke="none" fill="var(--highlight-color)"><path transform="rotate(0)" d="M 149.39 -16.97 M 149.62 -16.98 M 150.29 -17 M 151.42 -16.97 M 153 -16.85 M 155.02 -16.57 M 157.46 -16.1 M 160.32 -15.39 M 163.56 -14.39 M 167.17 -13.06 M 171.11 -11.35 M 175.36 -9.23 M 179.88 -6.66 M 179.88 6.66 M 175.36 9.23 M 171.11 11.35 M 167.17 13.06 M 163.56 14.39 M 160.32 15.39 M 157.46 16.1 M 155.02 16.57 M 153 16.85 M 151.42 16.97 M 150.29 17 M 149.62 16.98 M 149.39 16.97 A 8 8 0 0 0 144.51 41.5 L 144.73 41.57 L 145.36 41.81 L 146.39 42.27 L 147.8 42.99 L 149.56 44.01 L 151.64 45.38 L 154 47.13 L 156.62 49.29 L 159.44 51.9 L 162.43 54.99 L 165.54 58.58 L 168.73 62.69 L 163.64 74.98 L 158.48 75.64 L 153.74 75.97 L 149.44 76.04 L 145.6 75.89 L 142.22 75.57 L 139.31 75.14 L 136.88 74.63 L 134.91 74.11 L 133.4 73.63 L 132.35 73.22 L 131.73 72.95 L 131.53 72.84 A 8 8 0 0 0 117.63 93.64 L 117.8 93.79 L 118.3 94.25 L 119.07 95.07 L 120.1 96.28 L 121.33 97.9 L 122.73 99.96 L 124.24 102.48 L 125.83 105.48 L 127.44 108.97 L 129.02 112.96 L 130.52 117.47 L 131.9 122.49 L 122.49 131.9 L 117.47 130.52 L 112.96 129.02 L 108.97 127.44 L 105.48 125.83 L 102.48 124.24 L 99.96 122.73 L 97.9 121.33 L 96.28 120.1 L 95.07 119.07 L 94.25 118.3 L 93.79 117.8 L 93.64 117.63 A 8 8 0 0 0 72.84 131.53 L 72.95 131.73 L 73.22 132.35 L 73.63 133.4 L 74.11 134.91 L 74.63 136.88 L 75.14 139.31 L 75.57 142.22 L 75.89 145.6 L 76.04 149.44 L 75.97 153.74 L 75.64 158.48 L 74.98 163.64 L 62.69 168.73 L 58.58 165.54 L 54.99 162.43 L 51.9 159.44 L 49.29 156.62 L 47.13 154 L 45.38 151.64 L 44.01 149.56 L 42.99 147.8 L 42.27 146.39 L 41.81 145.36 L 41.57 144.73 L 41.5 144.51 A 8 8 0 0 0 16.97 149.39 L 16.98 149.62 L 17 150.29 L 16.97 151.42 L 16.85 153 L 16.57 155.02 L 16.1 157.46 L 15.39 160.32 L 14.39 163.56 L 13.06 167.17 L 11.35 171.11 L 9.23 175.36 L 6.66 179.88 L -6.66 179.88 L -9.23 175.36 L -11.35 171.11 L -13.06 167.17 L -14.39 163.56 L -15.39 160.32 L -16.1 157.46 L -16.57 155.02 L -16.85 153 L -16.97 151.42 L -17 150.29 L -16.98 149.62 L -16.97 149.39 A 8 8 0 0 0 -41.5 144.51 L -41.57 144.73 L -41.81 145.36 L -42.27 146.39 L -42.99 147.8 L -44.01 149.56 L -45.38 151.64 L -47.13 154 L -49.29 156.62 L -51.9 159.44 L -54.99 162.43 L -58.58 165.54 L -62.69 168.73 L -74.98 163.64 L -75.64 158.48 L -75.97 153.74 L -76.04 149.44 L -75.89 145.6 L -75.57 142.22 L -75.14 139.31 L -74.63 136.88 L -74.11 134.91 L -73.63 133.4 L -73.22 132.35 L -72.95 131.73 L -72.84 131.53 A 8 8 0 0 0 -93.64 117.63 L -93.79 117.8 L -94.25 118.3 L -95.07 119.07 L -96.28 120.1 L -97.9 121.33 L -99.96 122.73 L -102.48 124.24 L -105.48 125.83 L -108.97 127.44 L -112.96 129.02 L -117.47 130.52 L -122.49 131.9 L -131.9 122.49 L -130.52 117.47 L -129.02 112.96 L -127.44 108.97 L -125.83 105.48 L -124.24 102.48 L -122.73 99.96 L -121.33 97.9 L -120.1 96.28 L -119.07 95.07 L -118.3 94.25 L -117.8 93.79 L -117.63 93.64 A 8 8 0 0 0 -131.53 72.84 L -131.73 72.95 L -132.35 73.22 L -133.4 73.63 L -134.91 74.11 L -136.88 74.63 L -139.31 75.14 L -142.22 75.57 L -145.6 75.89 L -149.44 76.04 L -153.74 75.97 L -158.48 75.64 L -163.64 74.98 L -168.73 62.69 L -165.54 58.58 L -162.43 54.99 L -159.44 51.9 L -156.62 49.29 L -154 47.13 L -151.64 45.38 L -149.56 44.01 L -147.8 42.99 L -146.39 42.27 L -145.36 41.81 L -144.73 41.57 L -144.51 41.5 A 8 8 0 0 0 -149.39 16.97 L -149.62 16.98 L -150.29 17 L -151.42 16.97 L -153 16.85 L -155.02 16.57 L -157.46 16.1 L -160.32 15.39 L -163.56 14.39 L -167.17 13.06 L -171.11 11.35 L -175.36 9.23 L -179.88 6.66 L -179.88 -6.66 L -175.36 -9.23 L -171.11 -11.35 L -167.17 -13.06 L -163.56 -14.39 L -160.32 -15.39 L -157.46 -16.1 L -155.02 -16.57 L -153 -16.85 L -151.42 -16.97 L -150.29 -17 L -149.62 -16.98 L -149.39 -16.97 A 8 8 0 0 0 -144.51 -41.5 L -144.73 -41.57 L -145.36 -41.81 L -146.39 -42.27 L -147.8 -42.99 L -149.56 -44.01 L -151.64 -45.38 L -154 -47.13 L -156.62 -49.29 L -159.44 -51.9 L -162.43 -54.99 L -165.54 -58.58 L -168.73 -62.69 L -163.64 -74.98 L -158.48 -75.64 L -153.74 -75.97 L -149.44 -76.04 L -145.6 -75.89 L -142.22 -75.57 L -139.31 -75.14 L -136.88 -74.63 L -134.91 -74.11 L -133.4 -73.63 L -132.35 -73.22 L -131.73 -72.95 L -131.53 -72.84 A 8 8 0 0 0 -117.63 -93.64 L -117.8 -93.79 L -118.3 -94.25 L -119.07 -95.07 L -120.1 -96.28 L -121.33 -97.9 L -122.73 -99.96 L -124.24 -102.48 L -125.83 -105.48 L -127.44 -108.97 L -129.02 -112.96 L -130.52 -117.47 L -131.9 -122.49 L -122.49 -131.9 L -117.47 -130.52 L -112.96 -129.02 L -108.97 -127.44 L -105.48 -125.83 L -102.48 -124.24 L -99.96 -122.73 L -97.9 -121.33 L -96.28 -120.1 L -95.07 -119.07 L -94.25 -118.3 L -93.79 -117.8 L -93.64 -117.63 A 8 8 0 0 0 -72.84 -131.53 L -72.95 -131.73 L -73.22 -132.35 L -73.63 -133.4 L -74.11 -134.91 L -74.63 -136.88 L -75.14 -139.31 L -75.57 -142.22 L -75.89 -145.6 L -76.04 -149.44 L -75.97 -153.74 L -75.64 -158.48 L -74.98 -163.64 L -62.69 -168.73 L -58.58 -165.54 L -54.99 -162.43 L -51.9 -159.44 L -49.29 -156.62 L -47.13 -154 L -45.38 -151.64 L -44.01 -149.56 L -42.99 -147.8 L -42.27 -146.39 L -41.81 -145.36 L -41.57 -144.73 L -41.5 -144.51 A 8 8 0 0 0 -16.97 -149.39 L -16.98 -149.62 L -17 -150.29 L -16.97 -151.42 L -16.85 -153 L -16.57 -155.02 L -16.1 -157.46 L -15.39 -160.32 L -14.39 -163.56 L -13.06 -167.17 L -11.35 -171.11 L -9.23 -175.36 L -6.66 -179.88 L 6.66 -179.88 L 9.23 -175.36 L 11.35 -171.11 L 13.06 -167.17 L 14.39 -163.56 L 15.39 -160.32 L 16.1 -157.46 L 16.57 -155.02 L 16.85 -153 L 16.97 -151.42 L 17 -150.29 L 16.98 -149.62 L 16.97 -149.39 A 8 8 0 0 0 41.5 -144.51 L 41.57 -144.73 L 41.81 -145.36 L 42.27 -146.39 L 42.99 -147.8 L 44.01 -149.56 L 45.38 -151.64 L 47.13 -154 L 49.29 -156.62 L 51.9 -159.44 L 54.99 -162.43 L 58.58 -165.54 L 62.69 -168.73 L 74.98 -163.64 L 75.64 -158.48 L 75.97 -153.74 L 76.04 -149.44 L 75.89 -145.6 L 75.57 -142.22 L 75.14 -139.31 L 74.63 -136.88 L 74.11 -134.91 L 73.63 -133.4 L 73.22 -132.35 L 72.95 -131.73 L 72.84 -131.53 A 8 8 0 0 0 93.64 -117.63 L 93.79 -117.8 L 94.25 -118.3 L 95.07 -119.07 L 96.28 -120.1 L 97.9 -121.33 L 99.96 -122.73 L 102.48 -124.24 L 105.48 -125.83 L 108.97 -127.44 L 112.96 -129.02 L 117.47 -130.52 L 122.49 -131.9 L 131.9 -122.49 L 130.52 -117.47 L 129.02 -112.96 L 127.44 -108.97 L 125.83 -105.48 L 124.24 -102.48 L 122.73 -99.96 L 121.33 -97.9 L 120.1 -96.28 L 119.07 -95.07 L 118.3 -94.25 L 117.8 -93.79 L 117.63 -93.64 A 8 8 0 0 0 131.53 -72.84 L 131.73 -72.95 L 132.35 -73.22 L 133.4 -73.63 L 134.91 -74.11 L 136.88 -74.63 L 139.31 -75.14 L 142.22 -75.57 L 145.6 -75.89 L 149.44 -76.04 L 153.74 -75.97 L 158.48 -75.64 L 163.64 -74.98 L 168.73 -62.69 L 165.54 -58.58 L 162.43 -54.99 L 159.44 -51.9 L 156.62 -49.29 L 154 -47.13 L 151.64 -45.38 L 149.56 -44.01 L 147.8 -42.99 L 146.39 -42.27 L 145.36 -41.81 L 144.73 -41.57 L 144.51 -41.5 A 8 8 0 0 0 149.39 -16.97 L 149.62 -16.98 L 150.29 -17 L 151.42 -16.97 L 153 -16.85 L 155.02 -16.57 L 157.46 -16.1 L 160.32 -15.39 L 163.56 -14.39 L 167.17 -13.06 L 171.11 -11.35 L 175.36 -9.23 L 179.88 -6.66 L 179.88 6.66 L 175.36 9.23 L 171.11 11.35 L 167.17 13.06 L 163.56 14.39 L 160.32 15.39 L 157.46 16.1 L 155.02 16.57 L 153 16.85 L 151.42 16.97 L 150.29 17 L 149.62 16.98 L 149.39 16.97
			  M -110 0
				a 110 110 0 1 0 220 0
				a 110 110 0 1 0 -220 0
			" mask="url(#wedge-mask)" stroke="none" stroke-width="4"></path><circle cx="0" cy="0" r="60" stroke="none"></circle><path d="
						M 0 -28
						L 160 -14
						L 160 14
						L 0 28
						Z
					"></path></g></svg>Crank.js</a></div><div><a href="/guides/getting-started" aria-current="page">Guides</a></div><div><a href="/blog/">Blog</a></div><div><a href="/playground/">Playground</a></div></div><div class="css-1n0j5y9"><div><a href="https://github.com/bikeshaving/crank">GitHub</a></div><div><a href="http://npm.im/@b9g/crank">NPM</a></div><button role="switch" aria-label="set dark mode" aria-checked="false">⬜</button></div></nav></div><div id="sidebar" class="css-1wkb9s8"><h2 class="css-ep9szm">Guides</h2><div class="css-w1ljn4"><a href="/guides/getting-started" class="css-1l0nd7p">Getting Started</a></div><div class="css-w1ljn4"><a href="/guides/elements" class="css-1l0nd7p">Elements and Renderers</a></div><div class="css-w1ljn4"><a href="/guides/components" class="css-1l0nd7p">Components</a></div><div class="css-w1ljn4"><a href="/guides/handling-events" class="css-1l0nd7p">Handling Events</a></div><div class="css-w1ljn4"><a href="/guides/async-components" class="css-1l0nd7p">Async Components</a></div><div class="css-w1ljn4"><a href="/guides/special-props-and-tags" class="css-1l0nd7p">Special Props and Tags</a></div><div class="css-w1ljn4"><a href="/guides/lifecycles" aria-current="page" class="css-1l0nd7p">Lifecycles</a></div><div class="css-w1ljn4"><a href="/guides/hydration" class="css-1l0nd7p">Hydration</a></div><div class="css-w1ljn4"><a href="/guides/reusable-logic" class="css-1l0nd7p">Reusable Logic</a></div><div class="css-w1ljn4"><a href="/guides/working-with-typescript" class="css-1l0nd7p">Working with TypeScript</a></div><div class="css-w1ljn4"><a href="/guides/custom-renderers" class="css-1l0nd7p">Custom Renderers</a></div><div class="css-w1ljn4"><a href="/guides/reference-for-react-developers" class="css-1l0nd7p">React to Crank Migration Guide</a></div><div class="css-w1ljn4"><a href="/guides/jsx-template-tag" class="css-1l0nd7p">JSX Template Tag</a></div></div><main class="css-1mkiuoh"><h1>Lifecycles</h1><p>Component lifecycles in Crank are straightforward: they follow the natural flow of JavaScript generator functions. Unlike other frameworks that require special lifecycle methods, Crank lets you write lifecycle logic using normal JavaScript.</p><h2>The Natural Generator Lifecycle</h2><p>Generator components have a simple, predictable lifecycle that mirrors the generator execution:</p><h3>Mount Phase</h3><p>When a component first renders, the generator function starts executing until it hits the first <code class="inline">yield</code>:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">LifecycleDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token comment">// mount phase for logic before rendering</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token comment">// This `for...of` loop IS the component lifecycle</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token comment">// code which executes after we received props</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>Count<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>          Increment</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>    <span class="token comment">// code which executes before we receive new props</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>  <span class="token comment">// code which executes before we unmount</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>LifecycleDemo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-167" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-167'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *LifecycleDemo() {\n\n  \u002F\u002F mount phase for logic before rendering\n  let count = 0;\n\n  \u002F\u002F This `for...of` loop IS the component lifecycle\n  for ({} of this) {\n    \u002F\u002F code which executes after we received props\n    yield (\n      \u003Cdiv\u003E\n        \u003Cp\u003ECount: {count}\u003C\u002Fp\u003E\n        \u003Cbutton onclick={() =\u003E this.refresh(() =\u003E count++)}\u003E\n          Increment\n        \u003C\u002Fbutton\u003E\n      \u003C\u002Fdiv\u003E\n    );\n    \u002F\u002F code which executes before we receive new props\n  }\n\n  \u002F\u002F code which executes before we unmount\n}\n\nrenderer.render(\u003CLifecycleDemo \u002F\u003E, document.body);","lang":"jsx"};
		</script></div><h3>Update Phase</h3><p>When <code class="inline">this.refresh()</code> is called, the generator resumes from where it paused (after the <code class="inline">yield</code>) and continues to the next iteration of the loop. This gives you two important spaces for update logic:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">UpdateDemo</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">let</span> oldCount <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// What the count was in the previous render</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>          <span class="token literal-property property">Current</span><span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>          <span class="token punctuation">{</span>oldCount <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> | Previous: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>    oldCount <span class="token operator">=</span> count<span class="token punctuation">;</span> <span class="token comment">// Save current props as &quot;old&quot; for next comparison</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code>          <span class="token function">Increment</span> <span class="token punctuation">(</span>count<span class="token operator">:</span> <span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token punctuation">)</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>        <span class="token operator">&lt;</span>UpdateDemo count<span class="token operator">=</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-168" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-168'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *UpdateDemo({count}) {\n  let oldCount = null; \u002F\u002F What the count was in the previous render\n\n  for ({count} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cp\u003E\n          Current: {count}\n          {oldCount != null && ` | Previous: ${oldCount}`}\n        \u003C\u002Fp\u003E\n      \u003C\u002Fdiv\u003E\n    );\n\n    oldCount = count; \u002F\u002F Save current props as \"old\" for next comparison\n  }\n}\n\nfunction *App() {\n  let count = 0;\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cbutton onclick={() =\u003E this.refresh(() =\u003E count++)}\u003E\n          Increment (count: {count})\n        \u003C\u002Fbutton\u003E\n        \u003CUpdateDemo count={count} \u002F\u003E\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CApp \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><p>The key insight: you have TWO execution spaces in each loop iteration:</p><ul><li><strong>Before <code class="inline">yield</code></strong>: Set up for the current render</li><li><strong>After <code class="inline">yield</code></strong>: Only runs when re-rendering - save current state as &quot;old&quot; state for comparison</li></ul><p>Here&#039;s a practical example using prop comparison for memoization:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">ExpensiveComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>items<span class="token punctuation">,</span> threshold<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">let</span> oldItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">let</span> oldThreshold <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">let</span> cachedResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>items<span class="token punctuation">,</span> threshold<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token comment">// Check if we can use cached result</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">const</span> itemsChanged <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>oldItems<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    <span class="token keyword">const</span> thresholdChanged <span class="token operator">=</span> threshold <span class="token operator">!==</span> oldThreshold<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cachedResult <span class="token operator">||</span> itemsChanged <span class="token operator">||</span> thresholdChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>      <span class="token comment">// Simulate expensive calculation</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>      cachedResult <span class="token operator">=</span> items</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> threshold<span class="token punctuation">)</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#039;, &#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>        <span class="token operator">&lt;</span>h3<span class="token operator">&gt;</span>Filtered <span class="token function">Items</span> <span class="token punctuation">(</span>threshold<span class="token operator">:</span> <span class="token punctuation">{</span>threshold<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span>cachedResult <span class="token operator">||</span> <span class="token string">&quot;No items match&quot;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code>    <span class="token comment">// Save current props as &quot;old&quot; for next comparison</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>    oldItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>items<span class="token punctuation">]</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>    oldThreshold <span class="token operator">=</span> threshold<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>  <span class="token keyword">let</span> threshold <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><code>  <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code>    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Item A&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><code>    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Item B&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">75</span><span class="token punctuation">}</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>    <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;Item C&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="39"><code>  <span class="token punctuation">]</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="40"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="41"><code>  <span class="token keyword">const</span> <span class="token function-variable function">updateThreshold</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="42"><code>    threshold <span class="token operator">=</span> threshold <span class="token operator">===</span> <span class="token number">50</span> <span class="token operator">?</span> <span class="token number">30</span> <span class="token operator">:</span> <span class="token number">50</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="43"><code>  <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="44"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="45"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="46"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="47"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="48"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>updateThreshold<span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="49"><code>          Toggle <span class="token function">Threshold</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>threshold<span class="token punctuation">}</span><span class="token punctuation">)</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="50"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="51"><code>        <span class="token operator">&lt;</span>ExpensiveComponent items<span class="token operator">=</span><span class="token punctuation">{</span>items<span class="token punctuation">}</span> threshold<span class="token operator">=</span><span class="token punctuation">{</span>threshold<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="52"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="53"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="54"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="55"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="56"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="57"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-169" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-169'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *ExpensiveComponent({items, threshold}) {\n  let oldItems = [];\n  let oldThreshold = 0;\n  let cachedResult = null;\n\n  for ({items, threshold} of this) {\n    \u002F\u002F Check if we can use cached result\n    const itemsChanged = JSON.stringify(items) !== JSON.stringify(oldItems);\n    const thresholdChanged = threshold !== oldThreshold;\n\n    if (!cachedResult || itemsChanged || thresholdChanged) {\n      \u002F\u002F Simulate expensive calculation\n      cachedResult = items\n        .filter(item =\u003E item.value \u003E threshold)\n        .map(item =\u003E `${item.name}: ${item.value}`)\n        .join(', ');\n    }\n\n    yield (\n      \u003Cdiv\u003E\n        \u003Ch3\u003EFiltered Items (threshold: {threshold})\u003C\u002Fh3\u003E\n        \u003Cp\u003E{cachedResult || \"No items match\"}\u003C\u002Fp\u003E\n      \u003C\u002Fdiv\u003E\n    );\n\n    \u002F\u002F Save current props as \"old\" for next comparison\n    oldItems = [...items];\n    oldThreshold = threshold;\n  }\n}\n\nfunction *App() {\n  let threshold = 50;\n  const items = [\n    {name: \"Item A\", value: 25},\n    {name: \"Item B\", value: 75},\n    {name: \"Item C\", value: 100}\n  ];\n\n  const updateThreshold = () =\u003E this.refresh(() =\u003E\n    threshold = threshold === 50 ? 30 : 50\n  );\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cbutton onclick={updateThreshold}\u003E\n          Toggle Threshold ({threshold})\n        \u003C\u002Fbutton\u003E\n        \u003CExpensiveComponent items={items} threshold={threshold} \u002F\u003E\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CApp \u002F\u003E, document.body);","lang":"jsx"};
		</script></div><h3>Unmount Phase</h3><p>When the component is removed from the tree, the generator exits the <code class="inline">for...of</code> loop and any code after it runs as cleanup:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Timer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">let</span> seconds <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ctx<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> seconds<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token keyword">of</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token punctuation">{</span>seconds<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token comment">// When the component unmounts, the props iterator returns and code after the</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>  <span class="token comment">// loop can run</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-170" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-170'] = {"code":"function *Timer({message}, ctx) {\n  let seconds = 0;\n  const interval = setInterval(() =\u003E ctx.refresh(() =\u003E seconds++), 1000);\n\n  for ({message} of ctx) {\n    yield (\n      \u003Cdiv\u003E{message} {seconds}\u003C\u002Fdiv\u003E\n    );\n  }\n  \u002F\u002F When the component unmounts, the props iterator returns and code after the\n  \u002F\u002F loop can run\n  clearInterval(interval);\n}","lang":"jsx"};
		</script></div><h2>Why You Need Extra Lifecycle Methods</h2><p>The natural generator lifecycle is perfect for most logic, but sometimes you need more precise timing around DOM operations. The <code class="inline">for...of</code> loop pauses at each <code class="inline">yield</code>, which means:</p><ul><li><strong>After <code class="inline">yield</code></strong>: The element description exists, but DOM nodes might not be created yet</li><li><strong>You need to know</strong>: When DOM nodes are created, when they&#039;re inserted, and when they&#039;re removed</li></ul><p>For these DOM-specific timings, Crank provides three lifecycle methods:</p><h3>Schedule: DOM Created but Not Inserted</h3><p><strong><code class="inline">schedule(callback)</code></strong> runs immediately after DOM nodes are created, but <strong>before they&#039;re inserted into the document</strong>. Useful for immediate DOM setup that doesn&#039;t require the element to be live in the document tree.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token comment">// Element exists but is NOT in the document yet</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Hello world<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-171" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-171'] = {"code":"function *Component() {\n  this.schedule((el) =\u003E {\n    \u002F\u002F Element exists but is NOT in the document yet\n    el.style.opacity = '0';\n  });\n\n  for ({} of this) {\n    yield \u003Cdiv\u003EHello world\u003C\u002Fdiv\u003E;\n  }\n}","lang":"jsx"};
		</script></div><h3>After: DOM Inserted and Live</h3><p><strong><code class="inline">after(callback)</code></strong> runs after the element is fully rendered and live in the DOM. This is where you&#039;d do things like focusing inputs, measuring elements, or triggering animations that require the element to be visible.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token comment">// Element is now live in the document</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Element is live:&#039;</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-172" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-172'] = {"code":"function *Component() {\n  this.after((el) =\u003E {\n    \u002F\u002F Element is now live in the document\n    el.focus();\n    console.log('Element is live:', element.getBoundingClientRect());\n  });\n\n  for ({} of this) {\n    yield \u003Cinput type=\"text\" \u002F\u003E;\n  }\n}","lang":"jsx"};
		</script></div><h3>Cleanup: DOM Removed and Unmounted</h3><p><strong><code class="inline">cleanup(callback)</code></strong> runs when the component is unmounted. Use this for cleaning up event listeners, timers, subscriptions, or performing exit animations.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;tick&#039;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Component cleaned up&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Timer running<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-173" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-173'] = {"code":"function *Component() {\n  const interval = setInterval(() =\u003E console.log('tick'), 1000);\n\n  this.cleanup(() =\u003E {\n    clearInterval(interval);\n    console.log('Component cleaned up');\n  });\n\n  for ({} of this) {\n    yield \u003Cdiv\u003ETimer running...\u003C\u002Fdiv\u003E;\n  }\n}","lang":"jsx"};
		</script></div><h3>Execution Order</h3><p>For any given render:</p><ol><li><code class="inline">schedule()</code> callbacks run first (element created but not inserted)</li><li><code class="inline">after()</code> callbacks run second (element live in DOM)</li><li><code class="inline">cleanup()</code> callbacks run when component unmounts</li></ol><h3>When to Use Which Method</h3><p>This timing difference is crucial for choosing the right method:</p><p><strong>Use <code class="inline">schedule()</code> for:</strong></p><ul><li>Setting up properties, styles, or attributes before the user sees the element</li><li>Triggering re-renders (the <code class="inline">this.schedule(() =&gt; this.refresh())</code> pattern)</li><li>DOM setup that doesn&#039;t require the element to be part of the document tree</li><li>Preparing elements before they become visible</li></ul><p><strong>Use <code class="inline">after()</code> for:</strong></p><ul><li>Focusing elements (requires element to be in the document)</li><li>Measuring dimensions with <code class="inline">getBoundingClientRect()</code></li><li>Triggering animations that need the element to be visible</li><li>Any DOM operations requiring the element to be live in the document tree</li></ul><p>The key insight: <code class="inline">schedule()</code> happens in the perfect &quot;sweet spot&quot; where you can modify elements without visual flicker, while <code class="inline">after()</code> gives you access to the fully live, measurable element.</p><h3>Promise-based API (0.7+)</h3><p>All three methods return promises when called without arguments:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Wait for DOM creation</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Wait for DOM insertion</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// ... component logic</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Wait for cleanup (on unmount)</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-174" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-174'] = {"code":"async function *Component() {\n  await this.schedule(); \u002F\u002F Wait for DOM creation\n  await this.after();    \u002F\u002F Wait for DOM insertion\n  \u002F\u002F ... component logic\n  await this.cleanup();  \u002F\u002F Wait for cleanup (on unmount)\n}","lang":"jsx"};
		</script></div><h3>Context State Properties (0.7+)</h3><p>The context provides two boolean properties to check component state:</p><h4>Execution State: <code class="inline">isExecuting</code></h4><p><strong><code class="inline">this.isExecuting</code></strong> is true when the component is currently executing (between yield points). Useful for avoiding redundant refresh calls:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token comment">// Avoid calling refresh if component is already executing</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isExecuting<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Refreshing&#039;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-175" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-175'] = {"code":"function *Component() {\n  const handleClick = () =\u003E {\n    \u002F\u002F Avoid calling refresh if component is already executing\n    if (!this.isExecuting) {\n      this.refresh(() =\u003E console.log('Refreshing'));\n    }\n  };\n\n  for ({} of this) {\n    yield \u003Cbutton onclick={handleClick}\u003EClick me\u003C\u002Fbutton\u003E;\n  }\n}","lang":"jsx"};
		</script></div><h4>Mount State: <code class="inline">isUnmounted</code></h4><p><strong><code class="inline">this.isUnmounted</code></strong> is true after the component has been unmounted. Useful for avoiding work in async operations after unmount:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#039;/api/data&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>      <span class="token comment">// Check if component was unmounted during the async operation</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>isUnmounted<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Component unmounted, skipping update&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>        <span class="token keyword">break</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>      <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Got data:&#039;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isUnmounted<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#039;Error fetching data:&#039;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>      <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-176" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-176'] = {"code":"async function *Component() {\n  for ({} of this) {\n    yield \u003Cdiv\u003ELoading...\u003C\u002Fdiv\u003E;\n\n    try {\n      const data = await fetch('\u002Fapi\u002Fdata');\n\n      \u002F\u002F Check if component was unmounted during the async operation\n      if (this.isUnmounted) {\n        console.log('Component unmounted, skipping update');\n        break;\n      }\n\n      this.refresh(() =\u003E console.log('Got data:', data));\n    } catch (error) {\n      if (!this.isUnmounted) {\n        console.error('Error fetching data:', error);\n      }\n    }\n  }\n}","lang":"jsx"};
		</script></div><p>These properties help write safer async code by preventing common issues like calling <code class="inline">refresh()</code> on unmounted components or doing unnecessary work after unmount.</p><h2>The Two-Pass Render Pattern</h2><p>Using <code class="inline">schedule(() =&gt; this.refresh())</code> for components that need to render twice.</p><p>A common pattern is to use <code class="inline">schedule()</code> to trigger an immediate re-render. This is particularly useful for components that need to render twice - once for initial setup, then again with updated state:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">TwoPassComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">let</span> secondPass <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>secondPass<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token comment">// Schedule a refresh to happen after this render</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> secondPass <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>secondPass<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>      <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>First render <span class="token operator">-</span> setting up<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>      <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Second render <span class="token operator">-</span> ready<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-177" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-177'] = {"code":"function *TwoPassComponent() {\n  let secondPass = false;\n\n  if (!secondPass) {\n    \u002F\u002F Schedule a refresh to happen after this render\n    this.schedule(() =\u003E this.refresh(() =\u003E secondPass = true));\n  }\n\n  for ({} of this) {\n    if (!secondPass) {\n      yield \u003Cdiv\u003EFirst render - setting up...\u003C\u002Fdiv\u003E;\n    } else {\n      yield \u003Cdiv\u003ESecond render - ready!\u003C\u002Fdiv\u003E;\n    }\n  }\n}","lang":"jsx"};
		</script></div><p>This pattern is especially powerful for:</p><p><strong>CSS-in-JS extraction during SSR:</strong></p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">SSRComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token comment">// First render to extract styles</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token comment">// Extract CSS from the rendered HTML</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token literal-property property">html</span><span class="token operator">:</span> finalHtml<span class="token punctuation">,</span> css<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">extractCritical</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    <span class="token comment">// Second render with extracted CSS</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>      <span class="token operator">&lt;</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>        <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token punctuation">{</span>css<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>        <span class="token operator">&lt;</span>div innerHTML<span class="token operator">=</span><span class="token punctuation">{</span>finalHtml<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-178" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-178'] = {"code":"function *SSRComponent({children}) {\n  for ({children} of this) {\n    \u002F\u002F First render to extract styles\n    this.schedule(() =\u003E this.refresh());\n\n    const html = yield \u003Cdiv\u003E{children}\u003C\u002Fdiv\u003E;\n\n    \u002F\u002F Extract CSS from the rendered HTML\n    const {html: finalHtml, css} = extractCritical(html);\n\n    \u002F\u002F Second render with extracted CSS\n    yield (\n      \u003C\u003E\n        \u003Cstyle\u003E{css}\u003C\u002Fstyle\u003E\n        \u003Cdiv innerHTML={finalHtml} \u002F\u003E\n      \u003C\u002F\u003E\n    );\n  }\n}","lang":"jsx"};
		</script></div><p><strong>Progressive enhancement:</strong></p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">ProgressiveComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">let</span> hydrated <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// After initial render, mark as hydrated and re-render</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> hydrated <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hydrated<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>      <span class="token keyword">yield</span> <span class="token operator">&lt;</span>InteractiveVersion <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>      <span class="token keyword">yield</span> <span class="token operator">&lt;</span>StaticVersion <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-179" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-179'] = {"code":"function *ProgressiveComponent() {\n  let hydrated = false;\n\n  \u002F\u002F After initial render, mark as hydrated and re-render\n  this.schedule(() =\u003E this.refresh(() =\u003E hydrated = true));\n\n  for ({} of this) {\n    if (hydrated) {\n      yield \u003CInteractiveVersion \u002F\u003E;\n    } else {\n      yield \u003CStaticVersion \u002F\u003E;\n    }\n  }\n}","lang":"jsx"};
		</script></div><p><strong>Measuring and adjusting:</strong></p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">ResponsiveComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token keyword">const</span> newWidth <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">!==</span> newWidth<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> width <span class="token operator">=</span> newWidth<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>        <span class="token literal-property property">Width</span><span class="token operator">:</span> <span class="token punctuation">{</span>width<span class="token punctuation">}</span>px</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>        <span class="token punctuation">{</span>width <span class="token operator">&gt;</span> <span class="token number">500</span> <span class="token operator">?</span> <span class="token operator">&lt;</span>LargeLayout <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token operator">&lt;</span>SmallLayout <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-180" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-180'] = {"code":"function *ResponsiveComponent() {\n  let width = 0;\n\n  this.schedule((element) =\u003E {\n    const newWidth = element.offsetWidth;\n    if (width !== newWidth) {\n      this.refresh(() =\u003E width = newWidth);\n    }\n  });\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        Width: {width}px\n        {width \u003E 500 ? \u003CLargeLayout \u002F\u003E : \u003CSmallLayout \u002F\u003E}\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}","lang":"jsx"};
		</script></div><p>The key insight is that <code class="inline">schedule()</code> runs after DOM nodes are created but <strong>before they&#039;re inserted into the document</strong>. This timing makes it the perfect place to trigger another render cycle - you can inspect or modify elements, but the user doesn&#039;t see any flicker because nothing has been inserted yet.</p><p><strong>Important:</strong> Since <code class="inline">schedule()</code> fires before DOM insertion, elements passed to schedule callbacks are not yet part of the document tree. Use <code class="inline">after()</code> if you need the element to be live in the DOM.</p><h2>Setup, update and teardown logic</h2><p>The execution of Crank components is well-defined and well-behaved, so there are no restrictions around where you need to place side-effects. This means much of setup, update and teardown logic can be placed directly in components.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Blinker</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>seconds<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// setup logic can go at the top of the scope</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">let</span> blinking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">const</span> <span class="token function-variable function">blink</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> blinking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> blinking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token keyword">let</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>blink<span class="token punctuation">,</span> seconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>  <span class="token keyword">let</span> oldSeconds <span class="token operator">=</span> seconds<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>seconds<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>    <span class="token comment">// update logic can go directly in the loop</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>seconds <span class="token operator">!==</span> oldSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>      blinking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>      <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>      interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>blink<span class="token punctuation">,</span> seconds <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>      oldSeconds <span class="token operator">=</span> seconds<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blinking<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code>      <span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string-property property">&quot;background-color&quot;</span><span class="token operator">:</span> blinking <span class="token operator">?</span> <span class="token string">&quot;red&quot;</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code>        <span class="token punctuation">{</span>blinking <span class="token operator">&amp;&amp;</span> <span class="token string">&quot;!!!&quot;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code>  <span class="token comment">// cleanup logic can go at the end of the loop</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code>  <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><code>  <span class="token keyword">let</span> seconds <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>  <span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> seconds <span class="token operator">=</span> ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="39"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="40"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="41"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="42"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="43"><code>        <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;seconds&quot;</span><span class="token operator">&gt;</span>Seconds<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token string">&quot; &quot;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="44"><code>        <span class="token operator">&lt;</span>input</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="45"><code>          id<span class="token operator">=</span><span class="token string">&quot;seconds&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="46"><code>          value<span class="token operator">=</span><span class="token punctuation">{</span>seconds<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="47"><code>          type<span class="token operator">=</span><span class="token string">&quot;number&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="48"><code>          min<span class="token operator">=</span><span class="token string">&quot;0.25&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="49"><code>          max<span class="token operator">=</span><span class="token string">&quot;5&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="50"><code>          step<span class="token operator">=</span><span class="token string">&quot;0.25&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="51"><code>          onchange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="52"><code>        <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="53"><code>        <span class="token operator">&lt;</span>Blinker seconds<span class="token operator">=</span><span class="token punctuation">{</span>seconds<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="54"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="55"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="56"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="57"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="58"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="59"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-181" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-181'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *Blinker({seconds}) {\n  \u002F\u002F setup logic can go at the top of the scope\n  let blinking = false;\n  const blink = async () =\u003E {\n    this.refresh(() =\u003E blinking = true);\n    await new Promise((r) =\u003E setTimeout(r, 100));\n    this.refresh(() =\u003E blinking = false);\n  };\n\n  let interval = setInterval(blink, seconds * 1000);\n  let oldSeconds = seconds;\n\n  for ({seconds} of this) {\n    \u002F\u002F update logic can go directly in the loop\n    if (seconds !== oldSeconds) {\n      blinking = false;\n      clearInterval(interval);\n      interval = setInterval(blink, seconds * 1000);\n      oldSeconds = seconds;\n    }\n\n    console.log(blinking);\n\n    yield (\n      \u003Cp style={{\"background-color\": blinking ? \"red\" : null}}\u003E\n        {blinking && \"!!!\"}\n      \u003C\u002Fp\u003E\n    );\n  }\n\n  \u002F\u002F cleanup logic can go at the end of the loop\n  clearInterval(interval);\n}\n\nfunction *App() {\n  let seconds = 1;\n  const onChange = (ev) =\u003E this.refresh(() =\u003E seconds = ev.target.value);\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Clabel for=\"seconds\"\u003ESeconds:\u003C\u002Flabel\u003E{\" \"}\n        \u003Cinput\n          id=\"seconds\"\n          value={seconds}\n          type=\"number\"\n          min=\"0.25\"\n          max=\"5\"\n          step=\"0.25\"\n          onchange={onChange}\n        \u002F\u003E\n        \u003CBlinker seconds={seconds} \u002F\u003E\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CApp \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><h2>Working with the DOM</h2><p>Logic which needs to happen after rendering, such as doing direct DOM manipulations or taking measurements, can be done directly after a <code class="inline">yield</code> in async generator components which use <code class="inline">for await...of</code> loops, because the component is continuously resumed until the bottom of the <code class="inline">for await</code> loop. Conveniently, the <code class="inline">yield</code> expression will evaluate to the rendered result of the component.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token keyword">const</span> div <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    <span class="token comment">// logic which manipulates the div can go here.</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> props<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-182" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-182'] = {"code":"async function *Component(this, props) {\n  for await (props of this) {\n    const div = yield \u003Cdiv \u002F\u003E;\n    \u002F\u002F logic which manipulates the div can go here.\n    div.innerHTML = props.innerHTML;\n  }\n}","lang":"jsx"};
		</script></div><p>Unfortunately, this approach will not work for code in <code class="inline">for...of</code> loops. In a <code class="inline">for...of</code> loop, the behavior of <code class="inline">yield</code> works such that the component will suspend at the <code class="inline">yield</code> for each render, and this behavior holds for both sync and async generator components. This behavior is necessary for sync generator components, because there is nowhere else to suspend, and is mimicked in async generator components, to make refactoring between sync and async generator components easier.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token comment">// The following behavior happens in both sync and async generator components</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code><span class="token comment">// so long as they use a `for...of` and not a `for await...of` loop.</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">let</span> div <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token keyword">const</span> <span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token comment">// If the component is only rendered once, div will still be null.</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token comment">// This does not work in sync components because the function is paused</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>    <span class="token comment">// exactly at the yield. Only after rendering a second time will cause the</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>    <span class="token comment">// div variable to be assigned.</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    div <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>div<span class="token punctuation">}</span><span class="token operator">&gt;</span>Click me<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>    <span class="token comment">// Any code below the yield will not run until the next render.</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-183" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-183'] = {"code":"\u002F\u002F The following behavior happens in both sync and async generator components\n\u002F\u002F so long as they use a `for...of` and not a `for await...of` loop.\n\nfunction *Component(this, props) {\n  let div = null;\n\n  const onclick = () =\u003E {\n    \u002F\u002F If the component is only rendered once, div will still be null.\n    console.log(div);\n  };\n  for ({} of this) {\n    \u002F\u002F This does not work in sync components because the function is paused\n    \u002F\u002F exactly at the yield. Only after rendering a second time will cause the\n    \u002F\u002F div variable to be assigned.\n    div = yield \u003Cbutton onclick={div}\u003EClick me\u003C\u002Fbutton\u003E;\n    \u002F\u002F Any code below the yield will not run until the next render.\n  }\n}","lang":"jsx"};
		</script></div><p>Thankfully, the Crank context provides two callback-based methods which allow you to run code after rendering has completed: <code class="inline">schedule()</code> and <code class="inline">flush()</code>.</p><p>The <code class="inline">schedule()</code> method behaves like code which runs in an async generator’s <code class="inline">for await...of</code> loop. It runs immediately after the children DOM nodes are created:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token keyword">for</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">div</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>      <span class="token comment">// the div is</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>      div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> props<span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-184" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-184'] = {"code":"function *Component(this, props) {\n  for await (props of this) {\n    this.schedule((div) =\u003E {\n      \u002F\u002F the div is\n      div.innerHTML = props.innerHTML;\n    });\n    yield \u003Cdiv \u002F\u003E;\n  }\n}","lang":"jsx"};
		</script></div><p>On the other hand, the <code class="inline">after()</code> method runs after the result is completely rendered and live in the DOM. This is necessary for use-cases such as auto-focusing inputs after the first render. The reason for the distinction between <code class="inline">schedule()</code> and <code class="inline">after()</code> is that Crank coordinates async rendering so that the rendering of multiple async siblings happens together, meaning there might be some time before a created DOM node is created but before it is added to its intended parent.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">AutoFocusingInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token comment">// this.schedule does not work because it fires before the input element is</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// added to the DOM</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token comment">// this.schedule((input) =&gt; input.focus());</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span>props <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>input <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>  <span class="token keyword">let</span> initial <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>          <span class="token punctuation">{</span>initial <span class="token operator">||</span> <span class="token operator">&lt;</span>AutoFocusingInput <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>          <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Refresh<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>    initial <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-185" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-185'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\nfunction *AutoFocusingInput(props) {\n  \u002F\u002F this.schedule does not work because it fires before the input element is\n  \u002F\u002F added to the DOM\n  \u002F\u002F this.schedule((input) =\u003E input.focus());\n  this.after((input) =\u003E input.focus());\n  for (props of this) {\n    yield \u003Cinput {...props}\u002F\u003E;\n  }\n}\n\nfunction *Component() {\n  let initial = true;\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cdiv\u003E\n          {initial || \u003CAutoFocusingInput \u002F\u003E}\n        \u003C\u002Fdiv\u003E\n        \u003Cdiv\u003E\n          \u003Cbutton onclick={() =\u003E this.refresh()}\u003ERefresh\u003C\u002Fbutton\u003E\n        \u003C\u002Fdiv\u003E\n      \u003C\u002Fdiv\u003E\n    );\n\n    initial = false;\n  }\n}\n\nrenderer.render(\u003CComponent \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><p>All <code class="inline">schedule()</code> callbacks will always fire before <code class="inline">after()</code> callbacks for a given render.</p><h2>Cleanup logic</h2><p>While you can use context iterators to write cleanup logic after <code class="inline">for...of</code> and <code class="inline">for await...of</code> loops, this does not account for errors in components, and it does work if you are not using a render loop. To solve these issues, you can use <code class="inline">try</code>/<code class="inline">finally</code> block. When a generator component is removed from the tree, Crank calls the <code class="inline">return</code> method on the component’s generator object.</p><p>You can think of it as whatever <code class="inline">yield</code> expression your component was suspended on being replaced by a <code class="inline">return</code> statement. This means any loops your component was in when the generator suspended are broken out of, and code after the yield does not execute.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>      <span class="token keyword">yield</span> <span class="token string">&quot;Hi&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;finally block executed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Cleanup <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;Hi&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code><span class="token comment">// &quot;finally block executed&quot;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;&quot;</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-186" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-186'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *Cleanup() {\n  try {\n    for ({} of this) {\n      yield \"Hi\";\n    }\n  } finally {\n    console.log(\"finally block executed\");\n  }\n}\n\nrenderer.render(\u003CCleanup \u002F\u003E, document.body);\nconsole.log(document.body); \u002F\u002F \"Hi\"\nrenderer.render(null, document.body);\n\u002F\u002F \"finally block executed\"\nconsole.log(document.body); \u002F\u002F \"\"","lang":"jsx"};
		</script></div><p><a href="https://eslint.org/docs/rules/no-unsafe-finally">The same best practices</a> which apply to <code class="inline">try</code> / <code class="inline">finally</code> statements in regular functions apply to generator components. In short, you should not yield or return anything in the <code class="inline">finally</code> block. Crank will not use the yielded or returned values and doing so might cause your components to inadvertently swallow errors or suspend in unexpected locations.</p><p>To write cleanup logic which can be abstractd outside the component function, you can use the <code class="inline">cleanup()</code> method on the context. This method is similar to <code class="inline">after()</code> and <code class="inline">schedule()</code> in that it takes a callback.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code><span class="token keyword">function</span> <span class="token function">addGlobalEventListener</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// ctx.cleanup allows you to write cleanup logic outside the component</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  ctx<span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">KeyboardListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token keyword">const</span> <span class="token function-variable function">listener</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">=</span> ev<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token function">addGlobalEventListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;keypress&quot;</span><span class="token punctuation">,</span> listener<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Last key pressed<span class="token operator">:</span> <span class="token punctuation">{</span>key <span class="token operator">||</span> <span class="token string">&quot;N/A&quot;</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>KeyboardListener <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-187" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-187'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\nfunction addGlobalEventListener(ctx, type, listener, options) {\n  window.addEventListener(type, listener, options);\n  \u002F\u002F ctx.cleanup allows you to write cleanup logic outside the component\n  ctx.cleanup(() =\u003E window.removeEventListener(type, listener, options));\n}\n\nfunction *KeyboardListener() {\n  let key = \"\";\n  const listener = (ev) =\u003E this.refresh(() =\u003E key = ev.key);\n\n  addGlobalEventListener(this, \"keypress\", listener);\n  for ({} of this) {\n    yield \u003Cdiv\u003ELast key pressed: {key || \"N\u002FA\"}\u003C\u002Fdiv\u003E\n  }\n}\n\nrenderer.render(\u003CKeyboardListener \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><p>The <code class="inline">cleanup()</code> method is also useful for refactoring teardown logic.</p><h2>Async Mount and Unmount</h2><p>Starting in Crank 0.7, both mounting and unmounting can be asynchronous, enabling powerful patterns like coordinated animations, lazy loading, and complex initialization sequences.</p><h3>Async Unmount</h3><p>You can make cleanup operations asynchronous by passing async functions to the <code class="inline">cleanup()</code> method. This is particularly useful for exit animations:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">FadeOutComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token comment">// Register async cleanup for smooth exit animation</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&#039;opacity 300ms ease-out&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token comment">// Wait for animation to complete before unmounting</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Component faded out and unmounted&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>        <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&#039;20px&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">&#039;#007bff&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#039;white&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>        <span class="token string-property property">&#039;border-radius&#039;</span><span class="token operator">:</span> <span class="token string">&#039;4px&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>        <span class="token literal-property property">opacity</span><span class="token operator">:</span> <span class="token string">&#039;1&#039;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>        <span class="token constant">I</span> will fade out when unmounted<span class="token operator">!</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>  <span class="token keyword">let</span> showComponent <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> showComponent <span class="token operator">=</span> <span class="token operator">!</span>showComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>toggle<span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code>          <span class="token punctuation">{</span>showComponent <span class="token operator">?</span> <span class="token string">&#039;Hide&#039;</span> <span class="token operator">:</span> <span class="token string">&#039;Show&#039;</span><span class="token punctuation">}</span> Component</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>        <span class="token punctuation">{</span>showComponent <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>FadeOutComponent <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="39"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="40"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="41"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="42"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="43"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="44"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-188" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-188'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *FadeOutComponent() {\n  \u002F\u002F Register async cleanup for smooth exit animation\n  this.cleanup(async (element) =\u003E {\n    element.style.transition = 'opacity 300ms ease-out';\n    element.style.opacity = '0';\n\n    \u002F\u002F Wait for animation to complete before unmounting\n    await new Promise(resolve =\u003E setTimeout(resolve, 300));\n    console.log('Component faded out and unmounted');\n  });\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv style={{\n        padding: '20px',\n        background: '#007bff',\n        color: 'white',\n        'border-radius': '4px',\n        opacity: '1'\n      }}\u003E\n        I will fade out when unmounted!\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nfunction *App() {\n  let showComponent = true;\n  const toggle = () =\u003E this.refresh(() =\u003E showComponent = !showComponent);\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cbutton onclick={toggle}\u003E\n          {showComponent ? 'Hide' : 'Show'} Component\n        \u003C\u002Fbutton\u003E\n        {showComponent && \u003CFadeOutComponent \u002F\u003E}\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CApp \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><p>Here&#039;s a more complex example with staggered letter animations:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Letter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token comment">// Stagger the exit animation based on delay</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&#039;all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#039;translateY(-20px) rotateZ(10deg)&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    element<span class="token punctuation">.</span>style<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>      <span class="token operator">&lt;</span>span style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>        <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token string">&#039;inline-block&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>        <span class="token literal-property property">transition</span><span class="token operator">:</span> <span class="token string">&#039;all 400ms ease&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>        <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token string">&#039;translateY(0) rotateZ(0deg)&#039;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>        <span class="token punctuation">{</span>children<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">AnimatedText</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><code>        <span class="token string-property property">&#039;font-size&#039;</span><span class="token operator">:</span> <span class="token string">&#039;24px&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code>        <span class="token string-property property">&#039;font-weight&#039;</span><span class="token operator">:</span> <span class="token string">&#039;bold&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code>        <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#039;#007bff&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>        <span class="token string-property property">&#039;line-height&#039;</span><span class="token operator">:</span> <span class="token string">&#039;1.5&#039;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><code>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code>        <span class="token punctuation">{</span>text<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#039;&#039;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">char<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><code>          <span class="token operator">&lt;</span>Letter key<span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span> delay<span class="token operator">=</span><span class="token punctuation">{</span>i <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>            <span class="token punctuation">{</span>char <span class="token operator">===</span> <span class="token string">&#039; &#039;</span> <span class="token operator">?</span> <span class="token string">&#039;\u00A0&#039;</span> <span class="token operator">:</span> char<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="39"><code>          <span class="token operator">&lt;</span><span class="token operator">/</span>Letter<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="40"><code>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="41"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="42"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="43"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="44"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="45"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="46"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">LettersDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="47"><code>  <span class="token keyword">let</span> showText <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="48"><code>  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> showText <span class="token operator">=</span> <span class="token operator">!</span>showText<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="49"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="50"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="51"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="52"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="53"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>toggle<span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="54"><code>          <span class="token punctuation">{</span>showText <span class="token operator">?</span> <span class="token string">&#039;Hide&#039;</span> <span class="token operator">:</span> <span class="token string">&#039;Show&#039;</span><span class="token punctuation">}</span> Animated Text</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="55"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="56"><code>        <span class="token punctuation">{</span>showText <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span>AnimatedText text<span class="token operator">=</span><span class="token string">&quot;Hello Crank!&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="57"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="58"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="59"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="60"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="61"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="62"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>LettersDemo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-189" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-189'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *Letter({children, delay = 0}) {\n  this.cleanup(async (element) =\u003E {\n    \u002F\u002F Stagger the exit animation based on delay\n    await new Promise(resolve =\u003E setTimeout(resolve, delay));\n\n    element.style.transition = 'all 400ms cubic-bezier(0.68, -0.55, 0.265, 1.55)';\n    element.style.transform = 'translateY(-20px) rotateZ(10deg)';\n    element.style.opacity = '0';\n\n    await new Promise(resolve =\u003E setTimeout(resolve, 400));\n  });\n\n  for ({children} of this) {\n    yield (\n      \u003Cspan style={{\n        display: 'inline-block',\n        transition: 'all 400ms ease',\n        transform: 'translateY(0) rotateZ(0deg)'\n      }}\u003E\n        {children}\n      \u003C\u002Fspan\u003E\n    );\n  }\n}\n\nfunction *AnimatedText({text}) {\n  for ({text} of this) {\n    yield (\n      \u003Cdiv style={{\n        'font-size': '24px',\n        'font-weight': 'bold',\n        color: '#007bff',\n        'line-height': '1.5'\n      }}\u003E\n        {text.split('').map((char, i) =\u003E (\n          \u003CLetter key={i} delay={i * 50}\u003E\n            {char === ' ' ? '\\u00A0' : char}\n          \u003C\u002FLetter\u003E\n        ))}\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nfunction *LettersDemo() {\n  let showText = true;\n  const toggle = () =\u003E this.refresh(() =\u003E showText = !showText);\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003Cbutton onclick={toggle}\u003E\n          {showText ? 'Hide' : 'Show'} Animated Text\n        \u003C\u002Fbutton\u003E\n        {showText && \u003CAnimatedText text=\"Hello Crank!\" \u002F\u003E}\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CLettersDemo \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><h3>Async Mount</h3><p>The <code class="inline">schedule()</code> method can also be asynchronous, allowing components to defer their initial mounting:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">LazyLoadComponent</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>src<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token comment">// Async mounting - component waits until image loads</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>      img<span class="token punctuation">.</span>onload <span class="token operator">=</span> resolve<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>      img<span class="token punctuation">.</span>onerror <span class="token operator">=</span> reject<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>src<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>src<span class="token punctuation">}</span> alt<span class="token operator">=</span><span class="token string">&quot;Lazy loaded&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-190" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-190'] = {"code":"function *LazyLoadComponent({src}) {\n  \u002F\u002F Async mounting - component waits until image loads\n  this.schedule(async (img) =\u003E {\n    return new Promise((resolve, reject) =\u003E {\n      img.onload = resolve;\n      img.onerror = reject;\n    });\n  });\n\n  for ({src} of this) {\n    yield \u003Cimg src={src} alt=\"Lazy loaded\" \u002F\u003E;\n  }\n}","lang":"jsx"};
		</script></div><h3>Complex Coordination</h3><p>Async mount and unmount enable sophisticated coordination patterns:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Modal</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">,</span> onClose<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token comment">// Async mount: slide in from top</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">modal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>    modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#039;translateY(-100%)&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">&#039;transform 200ms ease-out&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token comment">// Force reflow, then animate in</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    modal<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#039;translateY(0)&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>  <span class="token comment">// Async unmount: slide out to top</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">modal</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>    modal<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">&#039;translateY(-100%)&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">,</span> onClose<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">&#039;fixed&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>        <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code>        <span class="token literal-property property">bottom</span><span class="token operator">:</span> <span class="token string">&#039;0&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code>        <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">&#039;rgba(0,0,0,0.5)&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>        <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token string">&#039;flex&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>        <span class="token string-property property">&#039;align-items&#039;</span><span class="token operator">:</span> <span class="token string">&#039;center&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>        <span class="token string-property property">&#039;justify-content&#039;</span><span class="token operator">:</span> <span class="token string">&#039;center&#039;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><code>      <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code>        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code>          <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">&#039;white&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>          <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&#039;2rem&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><code>          <span class="token string-property property">&#039;border-radius&#039;</span><span class="token operator">:</span> <span class="token string">&#039;8px&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code>          <span class="token string-property property">&#039;max-width&#039;</span><span class="token operator">:</span> <span class="token string">&#039;500px&#039;</span><span class="token punctuation">,</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><code>          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">&#039;90%&#039;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="39"><code>          <span class="token punctuation">{</span>children<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="40"><code>          <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span>onClose<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string-property property">&#039;margin-top&#039;</span><span class="token operator">:</span> <span class="token string">&#039;1rem&#039;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="41"><code>            Close</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="42"><code>          <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="43"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="44"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="45"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="46"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="47"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-191" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-191'] = {"code":"function *Modal({children, onClose}) {\n  \u002F\u002F Async mount: slide in from top\n  this.schedule(async (modal) =\u003E {\n    modal.style.transform = 'translateY(-100%)';\n    modal.style.transition = 'transform 200ms ease-out';\n\n    \u002F\u002F Force reflow, then animate in\n    modal.offsetHeight;\n    modal.style.transform = 'translateY(0)';\n\n    await new Promise(resolve =\u003E setTimeout(resolve, 200));\n  });\n\n  \u002F\u002F Async unmount: slide out to top\n  this.cleanup(async (modal) =\u003E {\n    modal.style.transform = 'translateY(-100%)';\n    await new Promise(resolve =\u003E setTimeout(resolve, 200));\n  });\n\n  for ({children, onClose} of this) {\n    yield (\n      \u003Cdiv style={{\n        position: 'fixed',\n        top: '0',\n        left: '0',\n        right: '0',\n        bottom: '0',\n        background: 'rgba(0,0,0,0.5)',\n        display: 'flex',\n        'align-items': 'center',\n        'justify-content': 'center'\n      }}\u003E\n        \u003Cdiv style={{\n          background: 'white',\n          padding: '2rem',\n          'border-radius': '8px',\n          'max-width': '500px',\n          width: '90%'\n        }}\u003E\n          {children}\n          \u003Cbutton onclick={onClose} style={{'margin-top': '1rem'}}\u003E\n            Close\n          \u003C\u002Fbutton\u003E\n        \u003C\u002Fdiv\u003E\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}","lang":"jsx"};
		</script></div><h3>Promise-based Lifecycle Methods</h3><p>Starting in 0.7, lifecycle methods return promises when called without arguments, allowing you to await lifecycle events:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code>  <span class="token comment">// Wait for component to be fully mounted</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Component is now in the DOM&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>Mounted component<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token comment">// Wait for rendering to complete</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Render cycle complete&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>  <span class="token comment">// Wait for cleanup to finish</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>  <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#039;Component cleanup complete&#039;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-192" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-192'] = {"code":"async function *Component() {\n  \u002F\u002F Wait for component to be fully mounted\n  await this.schedule();\n  console.log('Component is now in the DOM');\n\n  for ({} of this) {\n    yield \u003Cdiv\u003EMounted component\u003C\u002Fdiv\u003E;\n\n    \u002F\u002F Wait for rendering to complete\n    await this.after();\n    console.log('Render cycle complete');\n  }\n\n  \u002F\u002F Wait for cleanup to finish\n  await this.cleanup();\n  console.log('Component cleanup complete');\n}","lang":"jsx"};
		</script></div><h3>Use Cases for Async Lifecycle</h3><p><strong>Async mounting is useful for:</strong></p><ul><li>Loading animations and transitions</li><li>Waiting for external resources (images, fonts, APIs)</li><li>Coordinating multiple component animations</li><li>Complex initialization sequences</li></ul><p><strong>Async unmounting enables:</strong></p><ul><li>Smooth exit animations</li><li>Saving component state before destruction</li><li>Coordinated cleanup across multiple components</li><li>User confirmation dialogs for destructive actions</li></ul><h3>Server-Side Rendering with CSS Extraction</h3><p>A powerful use case for async mounting is CSS-in-JS extraction during SSR:</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1vm8pxc"><div class="css-1s1lac9"><div class="css-18sfz2f"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>extractCritical<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#039;@emotion/server&#039;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Root</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>children<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token comment">// First render to extract styles</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code>    <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>      <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>        <span class="token punctuation">{</span>children<span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>    <span class="token comment">// Extract critical CSS from the rendered HTML</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    <span class="token keyword">const</span> <span class="token punctuation">{</span><span class="token literal-property property">html</span><span class="token operator">:</span> finalHtml<span class="token punctuation">,</span> css<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">extractCritical</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token comment">// Second render with extracted CSS inlined</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>      <span class="token operator">&lt;</span>html<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>        <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>          <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span><span class="token punctuation">{</span>css<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>        <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>        <span class="token operator">&lt;</span>body innerHTML<span class="token operator">=</span><span class="token punctuation">{</span>finalHtml<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div></div></div></div><script data-name="inline-code-block-props-193" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-193'] = {"code":"import {extractCritical} from '@emotion\u002Fserver';\n\nfunction *Root({children}) {\n  for ({children} of this) {\n    \u002F\u002F First render to extract styles\n    this.schedule(() =\u003E this.refresh());\n\n    const html = yield (\n      \u003Cbody\u003E\n        {children}\n      \u003C\u002Fbody\u003E\n    );\n\n    \u002F\u002F Extract critical CSS from the rendered HTML\n    const {html: finalHtml, css} = extractCritical(html);\n\n    \u002F\u002F Second render with extracted CSS inlined\n    yield (\n      \u003Chtml\u003E\n        \u003Chead\u003E\n          \u003Cstyle\u003E{css}\u003C\u002Fstyle\u003E\n        \u003C\u002Fhead\u003E\n        \u003Cbody innerHTML={finalHtml} \u002F\u003E\n      \u003C\u002Fhtml\u003E\n    );\n  }\n}","lang":"jsx"};
		</script></div><p>Async lifecycle methods provide fine-grained control over when and how components appear and disappear, enabling smooth user experiences and complex coordination patterns that would be difficult to achieve with synchronous-only lifecycles.</p><h2>Catching Errors</h2><p>It can be useful to catch errors thrown by components to show the user an error notification or to notify error-logging services. To facilitate this, Crank will cause <code class="inline">yield</code> expressions to rethrow errors which happen when rendering children. You can take advantage of this behavior by wrapping your <code class="inline">yield</code> operations in a <code class="inline">try</code> / <code class="inline">catch</code> block to catch errors caused by children.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Thrower</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>shouldThrow<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>shouldThrow<span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shouldThrow<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Component error triggered!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><code>    <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>    <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#039;green&#039;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>✅ Component working fine<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">ErrorDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>  <span class="token keyword">let</span> shouldThrow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code>    <span class="token keyword">try</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><code>       <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>         <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="19"><code>           <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> shouldThrow <span class="token operator">=</span> <span class="token operator">!</span>shouldThrow<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="20"><code>             <span class="token punctuation">{</span>shouldThrow <span class="token operator">?</span> <span class="token string">&#039;Fix Component&#039;</span> <span class="token operator">:</span> <span class="token string">&#039;Break Component&#039;</span><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="21"><code>           <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="22"><code>           <span class="token operator">&lt;</span>Thrower shouldThrow<span class="token operator">=</span><span class="token punctuation">{</span>shouldThrow<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="23"><code>         <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="24"><code>       <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="25"><code>     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="26"><code>       <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="27"><code>         <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">&#039;red&#039;</span><span class="token punctuation">,</span> <span class="token literal-property property">border</span><span class="token operator">:</span> <span class="token string">&#039;1px solid red&#039;</span><span class="token punctuation">,</span> <span class="token literal-property property">padding</span><span class="token operator">:</span> <span class="token string">&#039;10px&#039;</span><span class="token punctuation">,</span> <span class="token string-property property">&#039;border-radius&#039;</span><span class="token operator">:</span> <span class="token string">&#039;4px&#039;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="28"><code>           <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>❌ Error<span class="token operator">:</span> <span class="token punctuation">{</span>err<span class="token punctuation">.</span>message<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="29"><code>           <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> shouldThrow <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="30"><code>             Reset Component</code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="31"><code>           <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="32"><code>         <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="33"><code>       <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="34"><code>     <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="35"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="36"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="37"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="38"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>ErrorDemo <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-194" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-194'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *Thrower({shouldThrow}) {\n  for ({shouldThrow} of this) {\n    if (shouldThrow) {\n      throw new Error(\"Component error triggered!\");\n    }\n\n    yield \u003Cdiv style={{color: 'green'}}\u003E✅ Component working fine\u003C\u002Fdiv\u003E;\n  }\n}\n\nfunction *ErrorDemo() {\n  let shouldThrow = false;\n\n  for ({} of this) {\n    try {\n       yield (\n         \u003Cdiv\u003E\n           \u003Cbutton onclick={() =\u003E this.refresh(() =\u003E shouldThrow = !shouldThrow)}\u003E\n             {shouldThrow ? 'Fix Component' : 'Break Component'}\n           \u003C\u002Fbutton\u003E\n           \u003CThrower shouldThrow={shouldThrow} \u002F\u003E\n         \u003C\u002Fdiv\u003E\n       );\n     } catch (err) {\n       yield (\n         \u003Cdiv style={{color: 'red', border: '1px solid red', padding: '10px', 'border-radius': '4px'}}\u003E\n           \u003Cdiv\u003E❌ Error: {err.message}\u003C\u002Fdiv\u003E\n           \u003Cbutton onclick={() =\u003E this.refresh(() =\u003E shouldThrow = false)}\u003E\n             Reset Component\n           \u003C\u002Fbutton\u003E\n         \u003C\u002Fdiv\u003E\n       );\n     }\n  }\n}\n\nrenderer.render(\u003CErrorDemo \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div><h2>Returning values from generator components</h2><p>When you return from a generator component, the returned value is rendered and the component scope is thrown away, same as would happen when using a function component. This means that the component cannot have local variables which persist across returns.</p><div style="margin: 30px auto;" class="code-block-container"><div class="css-1cvb758"><div class="css-1s1lac9"><div class="css-by286k"><div class="css-1m42aok"><div class="css-artqa7"><content-area class="css-84ojsb"><pre autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" class="
							language-
							css-1ashatc
						"><div class="
				prism-line
				css-1flouoi
			" data-index="0"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>renderer<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@b9g/crank/dom&quot;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="1"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="2"><code>  <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="3"><code>  <span class="token keyword">yield</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="4"><code>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="5"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="6"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="7"><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="8"><code>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="9"><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="10"><code>      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="11"><code>        <span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="12"><code>        <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>Refresh<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="13"><code>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="14"><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="15"><code>  <span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="16"><code><span class="token punctuation">}</span></code><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="17"><br></div><div class="
				prism-line
				css-1flouoi
			" data-index="18"><code>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div></pre></content-area></div></div></div><div class="css-nuifz8"><div class="css-1nius9d"><div class="css-14pt8ki">Loading...</div><div class="css-j74n8p"><iframe class="
							playground-iframe
							css-hjkbgb
						" style="height: 100px;"></iframe></div></div></div></div></div><script data-name="inline-code-block-props-195" class="props">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['inline-code-block-props-195'] = {"code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\nfunction *Component() {\n  yield \u003Cdiv\u003E1\u003C\u002Fdiv\u003E;\n  yield \u003Cdiv\u003E2\u003C\u002Fdiv\u003E;\n  return \u003Cdiv\u003E3\u003C\u002Fdiv\u003E;\n}\n\nfunction *App() {\n  for ({} of this) {\n    yield (\n      \u003Cdiv\u003E\n        \u003CComponent \u002F\u003E\n        \u003Cbutton onclick={() =\u003E this.refresh()}\u003ERefresh\u003C\u002Fbutton\u003E\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CApp \u002F\u003E, document.body);","lang":"jsx live"};
		</script></div></main><script data-name="static-urls-196" id="static-urls">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['static-urls-196'] = {"@b9g\u002Fcrank":"\u002Fstatic\u002Fcrank-ESBVX7GV.js","@b9g\u002Fcrank.js":"\u002Fstatic\u002Fcrank-ESBVX7GV.js","@b9g\u002Fcrank\u002Fasync":"\u002Fstatic\u002Fasync-CGDMGMUQ.js","@b9g\u002Fcrank\u002Fasync.js":"\u002Fstatic\u002Fasync-CGDMGMUQ.js","@b9g\u002Fcrank\u002Fcrank":"\u002Fstatic\u002Fcrank-ESBVX7GV.js","@b9g\u002Fcrank\u002Fcrank.js":"\u002Fstatic\u002Fcrank-ESBVX7GV.js","@b9g\u002Fcrank\u002Fdom":"\u002Fstatic\u002Fdom-2ZE6YNF6.js","@b9g\u002Fcrank\u002Fdom.js":"\u002Fstatic\u002Fdom-2ZE6YNF6.js","@b9g\u002Fcrank\u002Fevent-target":"\u002Fstatic\u002Fevent-target-K6L2AQDD.js","@b9g\u002Fcrank\u002Fevent-target.js":"\u002Fstatic\u002Fevent-target-K6L2AQDD.js","@b9g\u002Fcrank\u002Fhtml":"\u002Fstatic\u002Fhtml-4XAEMDNI.js","@b9g\u002Fcrank\u002Fhtml.js":"\u002Fstatic\u002Fhtml-4XAEMDNI.js","@b9g\u002Fcrank\u002Fjsx-dev-runtime":"\u002Fstatic\u002Fjsx-runtime-VTCZGTQU.js","@b9g\u002Fcrank\u002Fjsx-dev-runtime.js":"\u002Fstatic\u002Fjsx-runtime-VTCZGTQU.js","@b9g\u002Fcrank\u002Fjsx-runtime":"\u002Fstatic\u002Fjsx-runtime-VTCZGTQU.js","@b9g\u002Fcrank\u002Fjsx-runtime.js":"\u002Fstatic\u002Fjsx-runtime-VTCZGTQU.js","@b9g\u002Fcrank\u002Fjsx-tag":"\u002Fstatic\u002Fjsx-tag-VPNOE4JP.js","@b9g\u002Fcrank\u002Fjsx-tag.js":"\u002Fstatic\u002Fjsx-tag-VPNOE4JP.js","@b9g\u002Fcrank\u002Fstandalone":"\u002Fstatic\u002Fstandalone-FJ3E2LNJ.js","@b9g\u002Fcrank\u002Fstandalone.js":"\u002Fstatic\u002Fstandalone-FJ3E2LNJ.js","client.css":"\u002Fstatic\u002Fclient-SW6MAMAL.css"};
		</script><script src="/static/navbar-MBN6NLBG.js"></script><script src="/static/code-blocks-VAVPFCJ2.js"></script></body></html>