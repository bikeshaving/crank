<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Crank.js | Handling Events</title><link href="/static/index-UEEVTAOK.css" rel="stylesheet" type="text/css"><link rel="shortcut icon" href="/static/favicon.ico"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-20910936-4"></script><script>
								window.dataLayer = window.dataLayer || [];
								function gtag(){dataLayer.push(arguments);}
								gtag('js', new Date());

								gtag('config', 'UA-20910936-4');
							</script></head><body><nav id="navbar" class="navbar"><div class="navbar-group"><div class="navbar-item"><a class="navbar-title-link false" href="/"><img class="navbar-logo" src="/static/logo.svg" alt=""><span>Crank.js</span></a></div><div class="navbar-item"><a class="current" href="/guides/getting-started">Docs</a></div><div class="navbar-item"><a href="/blog/">Blog</a></div></div><div class="navbar-group"><div class="navbar-item"><a href="https://github.com/bikeshaving/crank">GitHub</a></div><div class="navbar-item"><a href="http://npm.im/@bikeshaving/crank">NPM</a></div></div></nav><div class="non-footer"><div id="sidebar" class="sidebar"><h3>Guides</h3><div class="sidebar-item"><a href="/guides/getting-started" class="">Getting Started</a></div><div class="sidebar-item"><a href="/guides/elements" class="">JSX, Elements and Renderers</a></div><div class="sidebar-item"><a href="/guides/components" class="">Components</a></div><div class="sidebar-item"><a href="/guides/handling-events" class="current">Handling Events</a></div><div class="sidebar-item"><a href="/guides/async-components" class="">Async Components</a></div><div class="sidebar-item"><a href="/guides/special-props-and-tags" class="">Special Props and Tags</a></div><div class="sidebar-item"><a href="/guides/lifecycles" class="">Lifecycles</a></div><div class="sidebar-item"><a href="/guides/reusable-logic" class="">Reusable Logic</a></div><div class="sidebar-item"><a href="/guides/working-with-typescript" class="">Working with TypeScript</a></div><div class="sidebar-item"><a href="/guides/reference-for-react-developers" class="">Reference for React Developers</a></div><div class="sidebar-item"><a href="/guides/api-reference" class="">API Reference</a></div></div><main class="main"><div class="content"><h1>Handling Events</h1><p>Most web applications require some measure of interactivity, where the user interface updates according to input. To facilitate this, Crank provides two APIs for listening to events on rendered DOM nodes.</p><h2>DOM onevent Props</h2><p>You can attach event callbacks to host element directly using onevent props. These props start with <code class="inline">on</code>, are all lowercase, and correspond to the properties as specified according to the DOM’s <a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers">GlobalEventHandlers mixin API</a>. By combining event props, local variables and <code class="inline">this.refresh</code>, you can write interactive components.</p><div class="codeblock" data-code="function *Clicker() {
  let count = 0;
  const handleClick = () =&gt; {
    count++;
    this.refresh();
  };

  while (true) {
    yield (
      &lt;div&gt;
        The button has been clicked {count} {count === 1 ? &quot;time&quot; : &quot;times&quot;}.
        &lt;button onclick={handleClick}&gt;Click me&lt;/button&gt;
      &lt;/div&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        The button has been clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token punctuation">{</span>count <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;time&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;times&quot;</span><span class="token punctuation">}</span><span class="token punctuation">.</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><h2>The EventTarget Interface</h2><p>As an alternative to the onevent props API, Crank contexts also implement the same <code class="inline">EventTarget</code> interface used by the DOM. The <code class="inline">addEventListener</code> method attaches a listener to a component’s rendered DOM node or nodes.</p><div class="codeblock" data-code="function *Clicker() {
  let count = 0;
  this.addEventListener(&quot;click&quot;, () =&gt; {
    count++;
    this.refresh();
  });

  while (true) {
    yield (
      &lt;button&gt;I have been clicked {count} {count === 1 ? &quot;time&quot; : &quot;times&quot;}&lt;/button&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span><span class="token constant">I</span> have been clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token punctuation">{</span>count <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;time&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;times&quot;</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>The local state <code class="inline">count</code> is now updated in the event listener, which triggers when the rendered button is actually clicked.</p><p><strong>NOTE:</strong> When using the context’s <code class="inline">addEventListener</code> method, you do not have to call the <code class="inline">removeEventListener</code> method if you merely want to remove event listeners when the component is unmounted. This is done automatically.</p><p>The context’s <code class="inline">addEventListener</code> method only attaches to the top-level node or nodes which each component renders, so if you want to listen to events on a nested node, you must use event delegation.</p><div class="codeblock" data-code="function *Clicker() {
  let count = 0;
  this.addEventListener(&quot;click&quot;, (ev) =&gt; {
    if (ev.target.tagName === &quot;BUTTON&quot;) {
      count++;
      this.refresh();
    }
  });

  while (true) {
    yield (
      &lt;div&gt;
        The button has been clicked {count} {count === 1 ? &quot;time&quot; : &quot;times&quot;}.
        &lt;button&gt;Click me&lt;/button&gt;
      &lt;/div&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">Clicker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">&quot;BUTTON&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      count<span class="token operator">++</span><span class="token punctuation">;</span></code><br></div><div><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        The button has been clicked <span class="token punctuation">{</span>count<span class="token punctuation">}</span> <span class="token punctuation">{</span>count <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">&quot;time&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;times&quot;</span><span class="token punctuation">}</span><span class="token punctuation">.</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>Because the event listener is attached to the outer <code class="inline">div</code>, we have to filter events by <code class="inline">ev.target.tagName</code> in the listener to make sure we’re not incrementing <code class="inline">count</code> based on clicks which don’t target the <code class="inline">button</code> element.</p><h2>onevent vs EventTarget</h2><p>The props-based onevent API and the context-based EventTarget API both have their advantages. On the one hand, using onevent props means you don’t have to filter events by target. You register them on exactly the element you’d like to listen to.</p><p>On the other, using the <code class="inline">addEventListener</code> method allows you to take full advantage of the EventTarget API, which includes registering passive event listeners or listeners which are dispatched during the capture phase. Additionally, the EventTarget API can be used without referencing or accessing the child elements which a component renders, meaning you can use it to listen to components which are passed children, or in utility functions which don’t have access to produced elements.</p><p>Crank supports both API styles for convenience and flexibility.</p><h2>Dispatching Events</h2><p>Crank contexts implement the full EventTarget interface, meaning you can use <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent">the <code class="inline">dispatchEvent</code> method</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent">the <code class="inline">CustomEvent</code> class</a> to dispatch custom events to ancestor components:</p><div class="codeblock" data-code="function MyButton(props) {
  this.addEventListener(&quot;click&quot;, () =&gt; {
    this.dispatchEvent(new CustomEvent(&quot;mybuttonclick&quot;, {
      bubbles: true,
      detail: {id: props.id},
    }));
  });

  return (
    &lt;button {...props} /&gt;
  );
}

function MyButtons() {
  return [1, 2, 3, 4, 5].map((i) =&gt; (
    &lt;div&gt; 
      &lt;MyButton id={&quot;button&quot; + i}&gt;Button {i}&lt;/MyButton&gt;
    &lt;/div&gt;
  ));
}

function *MyApp() {
  let lastId;
  this.addEventListener(&quot;mybuttonclick&quot;, (ev) =&gt; {
    lastId = ev.detail.id;
    this.refresh();
  });

  while (true) {
    yield (
      &lt;div&gt;
        &lt;MyButtons /&gt;
        &lt;div&gt;Last pressed id: {lastId == null ? &quot;N/A&quot; : lastId}&lt;/div&gt;
      &lt;/div&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token function">MyButton</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span><span class="token string">&quot;mybuttonclick&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></code><br></div><div><code>      bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></code><br></div><div><code>      detail<span class="token operator">:</span> <span class="token punctuation">{</span>id<span class="token operator">:</span> props<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token punctuation">,</span></code><br></div><div><code>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token punctuation">(</span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>  <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token function">MyButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> </code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyButton</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">&quot;button&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span>Button <span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">MyButton</span></span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div><div><code></code><br></div><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> lastId<span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;mybuttonclick&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    lastId <span class="token operator">=</span> ev<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>id<span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyButtons</span></span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Last pressed id<span class="token operator">:</span> <span class="token punctuation">{</span>lastId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;N/A&quot;</span> <span class="token operator">:</span> lastId<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p><code class="inline">MyButton</code> is a function component which wraps a <code class="inline">button</code> element. It dispatches a <code class="inline">CustomEvent</code> whose type is <code class="inline">&quot;mybuttonclick&quot;</code> when it is pressed, and whose <code class="inline">detail</code> property contains data about the ID of the clicked button. This event is not triggered on the underlying DOM nodes; instead, it can be listened for by parent component contexts using event capturing and bubbling, and in the example, the event propagates and is handled by the <code class="inline">MyApp</code> component. Using custom events and event bubbling allows you to encapsulate state transitions within component hierarchies without the need for complex state management solutions used in other frameworks like Redux or VueX.</p><p>The preceding example also demonstrates a slight difference in the way the <code class="inline">addEventListener</code> method works in function components compared to generator components. With generator components, listeners stick between renders, and will continue to fire until the component is unmounted. However, with function components, because the <code class="inline">addEventListener</code> call would be invoked every time the component is rerendered, we remove and add listeners for each render. This allows function components to remain stateless while still listening for and dispatching events.</p><h2>Form Elements</h2><p>Form elements like inputs and textareas are stateful and by default update themselves automatically according to user input. JSX libraries like React and Inferno handle these types of elements by allowing their virtual representations to be “controlled” or “uncontrolled,” where being controlled means that the internal DOM node’s state is synced to the virtual representation’s props. These APIs manifest as special “uncontrolled” versions of props like <code class="inline">defaultValue</code> and <code class="inline">defaultChecked</code>.</p><p>Crank’s approach to this issue is slightly different, in that we do not view the virtual elements as the “source of truth” for the underlying DOM nodes. In practice, this design decision means that renderers do not retain the previously rendered props for host elements. For instance, Crank will not compare old and new props between renders to avoid mutating props which have not changed, and instead attempt to update every prop found in props.</p><p>Another consequence is that we don’t delete props which were present in one rendering and absent in the next. In the following example, the checkbox will never uncheck itself.</p><div class="codeblock" data-code="function *App() {
  let checked = false;
  this.addEventListener(&quot;click&quot;, (ev) =&gt; {
    if (ev.target.tagName === &quot;BUTTON&quot;) {
      checked = !checked;
      this.refresh();
    }
  });

  this.addEventListener(&quot;input&quot;, (ev) =&gt; ev.preventDefault());

  while (true) {
    if (checked) {
      yield (
        &lt;div&gt;
          &lt;button&gt;Toggle&lt;/button&gt;
          &lt;input type=&quot;checkbox&quot; checked /&gt;
        &lt;/div&gt;
      );
    } else {
      yield (
        &lt;div&gt;
          &lt;button&gt;Toggle&lt;/button&gt;
          &lt;input type=&quot;checkbox&quot; /&gt;
        &lt;/div&gt;
      );
    }
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">&quot;BUTTON&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      checked <span class="token operator">=</span> <span class="token operator">!</span>checked<span class="token punctuation">;</span></code><br></div><div><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>checked<span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></code><br></div><div><code>      <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>      <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>While frameworks like React notice the absence of the boolean <code class="inline">checked</code> prop between renders and mutate the input element, Crank does not. This means that the input element can only ever go from unchecked to checked, and not the other way around. To fix the above example, you would need to make sure the <code class="inline">checked</code> prop is always passed to the <code class="inline">input</code> element.</p><div class="codeblock" data-code="function *App() {
  let checked = false;
  this.addEventListener(&quot;click&quot;, (ev) =&gt; {
    if (ev.target.tagName === &quot;BUTTON&quot;) {
      checked = !checked;
      this.refresh();
    }
  });

  this.addEventListener(&quot;input&quot;, (ev) =&gt; ev.preventDefault());

  while (true) {
    yield (
      &lt;div&gt;
        &lt;button&gt;Toggle&lt;/button&gt;
        &lt;input type=&quot;checkbox&quot; checked={checked} /&gt;
      &lt;/div&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span> <span class="token operator">*</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">&quot;BUTTON&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      checked <span class="token operator">=</span> <span class="token operator">!</span>checked<span class="token punctuation">;</span></code><br></div><div><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ev</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> ev<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Toggle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checked</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>checked<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>This design decision means that we now have a way to make the same element prop both “uncontrolled” and “controlled” for an element. Here, for instance, is an input element which is uncontrolled, except that it resets when the button is clicked.</p><div class="codeblock" data-code="function* ResettingInput() {
  let reset = true;
  this.addEventListener(&quot;click&quot;, ev =&gt; {
    if (ev.target.tagName === &quot;BUTTON&quot;) {
      reset = true;
      this.refresh();
    }
  });

  while (true) {
    const reset1 = reset;
    reset = false;
    yield (
      &lt;div&gt;
        &lt;button&gt;Reset&lt;/button&gt;
        {reset1 ? &lt;input type=&quot;text&quot; value=&quot;&quot; /&gt; : &lt;input type=&quot;text&quot; /&gt;}
      &lt;/div&gt;
    );
  }
}" data-lang="jsx"><div class="playground"><content-area><pre class="editable" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><div><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">ResettingInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>  <span class="token keyword">let</span> reset <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">ev</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">&quot;BUTTON&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>      reset <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></code><br></div><div><code>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token punctuation">}</span></code><br></div><div><code>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code></code><br></div><div><code>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><br></div><div><code>    <span class="token keyword">const</span> reset1 <span class="token operator">=</span> reset<span class="token punctuation">;</span></code><br></div><div><code>    reset <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span></code><br></div><div><code>    <span class="token keyword">yield</span> <span class="token punctuation">(</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>Reset<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>        <span class="token punctuation">{</span>reset1 <span class="token operator">?</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span></code><br></div><div><code>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code><br></div><div><code>    <span class="token punctuation">)</span><span class="token punctuation">;</span></code><br></div><div><code>  <span class="token punctuation">}</span></code><br></div><div><code><span class="token punctuation">}</span></code><br></div></pre></content-area></div></div><p>In the above example, we use the <code class="inline">reset</code> flag to check whether we need to set the <code class="inline">value</code> prop of the underlying input DOM element, and we omit the <code class="inline">value</code> prop when we aren’t performing a reset. Because the prop is not cleared when absent from the virtual element’s props, Crank leaves it alone. Crank’s approach means we do not need special alternative props for uncontrolled behavior, and we can continue to use virtual element rendering over raw DOM mutations in those circumstances where we do need control.</p></div></main></div><script src="/static/index-FZKVRLRI.js"></script></body></html>