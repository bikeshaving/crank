<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Crank.js</title><link href="/static/client-TNOPHTVT.css" rel="stylesheet" type="text/css"><meta property="og:title" content="Crank.js"><meta property="og:url" content="https:/crank.js.org/playground"><meta property="og:description" content=""></head><body><script>
	(() => {
		const colorScheme = sessionStorage.getItem("color-scheme") ||
			(window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches
				? "dark" : "light"
			);
		if (colorScheme === "dark") {
			document.body.classList.remove("color-scheme-light");
		} else {
			document.body.classList.add("color-scheme-light");
		}
	})()</script><div id="navbar-root"><style data-emotion="css 1l1hcps 1xmwt0h">.css-1l1hcps{position:fixed;top:0;left:0;right:0;height:50px;z-index:999;gap:1em;}.css-1xmwt0h{border-bottom:1px solid var(--text-color);overflow-x:auto;background-color:inherit;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;gap:1em;}.css-1xmwt0h a{-webkit-text-decoration:none;text-decoration:none;font-weight:bold;}@media screen and (min-width: 800px){.css-1xmwt0h{padding:0 2em;}}</style><nav class="
				blur-background
				css-1l1hcps
				css-1xmwt0h
			"><style data-emotion="css 1n0j5y9">.css-1n0j5y9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:1em;}</style><div class="css-1n0j5y9"><div><a class="css-1n0j5y9" style="gap: 0.3em" href="/"><svg style="flex: none;" fill="none" viewBox="-200 -200 400 400" width="1.9em" height="1.9em"><defs><mask id="wedge-mask"><rect x="-200" y="-200" width="400" height="400" fill="white"></rect><path stroke="none" fill="black" d="
							M 0 0
							L 245.74561328669753 172.07293090531383
							L 245.74561328669753 -172.07293090531383
							z
						"></path></mask></defs><g stroke="none" fill="#dbb368"><path transform="rotate(0)" d="M 149.39 -16.97 M 149.62 -16.98 M 150.29 -17 M 151.42 -16.97 M 153 -16.85 M 155.02 -16.57 M 157.46 -16.1 M 160.32 -15.39 M 163.56 -14.39 M 167.17 -13.06 M 171.11 -11.35 M 175.36 -9.23 M 179.88 -6.66 M 179.88 6.66 M 175.36 9.23 M 171.11 11.35 M 167.17 13.06 M 163.56 14.39 M 160.32 15.39 M 157.46 16.1 M 155.02 16.57 M 153 16.85 M 151.42 16.97 M 150.29 17 M 149.62 16.98 M 149.39 16.97 A 8 8 0 0 0 144.51 41.5 L 144.73 41.57 L 145.36 41.81 L 146.39 42.27 L 147.8 42.99 L 149.56 44.01 L 151.64 45.38 L 154 47.13 L 156.62 49.29 L 159.44 51.9 L 162.43 54.99 L 165.54 58.58 L 168.73 62.69 L 163.64 74.98 L 158.48 75.64 L 153.74 75.97 L 149.44 76.04 L 145.6 75.89 L 142.22 75.57 L 139.31 75.14 L 136.88 74.63 L 134.91 74.11 L 133.4 73.63 L 132.35 73.22 L 131.73 72.95 L 131.53 72.84 A 8 8 0 0 0 117.63 93.64 L 117.8 93.79 L 118.3 94.25 L 119.07 95.07 L 120.1 96.28 L 121.33 97.9 L 122.73 99.96 L 124.24 102.48 L 125.83 105.48 L 127.44 108.97 L 129.02 112.96 L 130.52 117.47 L 131.9 122.49 L 122.49 131.9 L 117.47 130.52 L 112.96 129.02 L 108.97 127.44 L 105.48 125.83 L 102.48 124.24 L 99.96 122.73 L 97.9 121.33 L 96.28 120.1 L 95.07 119.07 L 94.25 118.3 L 93.79 117.8 L 93.64 117.63 A 8 8 0 0 0 72.84 131.53 L 72.95 131.73 L 73.22 132.35 L 73.63 133.4 L 74.11 134.91 L 74.63 136.88 L 75.14 139.31 L 75.57 142.22 L 75.89 145.6 L 76.04 149.44 L 75.97 153.74 L 75.64 158.48 L 74.98 163.64 L 62.69 168.73 L 58.58 165.54 L 54.99 162.43 L 51.9 159.44 L 49.29 156.62 L 47.13 154 L 45.38 151.64 L 44.01 149.56 L 42.99 147.8 L 42.27 146.39 L 41.81 145.36 L 41.57 144.73 L 41.5 144.51 A 8 8 0 0 0 16.97 149.39 L 16.98 149.62 L 17 150.29 L 16.97 151.42 L 16.85 153 L 16.57 155.02 L 16.1 157.46 L 15.39 160.32 L 14.39 163.56 L 13.06 167.17 L 11.35 171.11 L 9.23 175.36 L 6.66 179.88 L -6.66 179.88 L -9.23 175.36 L -11.35 171.11 L -13.06 167.17 L -14.39 163.56 L -15.39 160.32 L -16.1 157.46 L -16.57 155.02 L -16.85 153 L -16.97 151.42 L -17 150.29 L -16.98 149.62 L -16.97 149.39 A 8 8 0 0 0 -41.5 144.51 L -41.57 144.73 L -41.81 145.36 L -42.27 146.39 L -42.99 147.8 L -44.01 149.56 L -45.38 151.64 L -47.13 154 L -49.29 156.62 L -51.9 159.44 L -54.99 162.43 L -58.58 165.54 L -62.69 168.73 L -74.98 163.64 L -75.64 158.48 L -75.97 153.74 L -76.04 149.44 L -75.89 145.6 L -75.57 142.22 L -75.14 139.31 L -74.63 136.88 L -74.11 134.91 L -73.63 133.4 L -73.22 132.35 L -72.95 131.73 L -72.84 131.53 A 8 8 0 0 0 -93.64 117.63 L -93.79 117.8 L -94.25 118.3 L -95.07 119.07 L -96.28 120.1 L -97.9 121.33 L -99.96 122.73 L -102.48 124.24 L -105.48 125.83 L -108.97 127.44 L -112.96 129.02 L -117.47 130.52 L -122.49 131.9 L -131.9 122.49 L -130.52 117.47 L -129.02 112.96 L -127.44 108.97 L -125.83 105.48 L -124.24 102.48 L -122.73 99.96 L -121.33 97.9 L -120.1 96.28 L -119.07 95.07 L -118.3 94.25 L -117.8 93.79 L -117.63 93.64 A 8 8 0 0 0 -131.53 72.84 L -131.73 72.95 L -132.35 73.22 L -133.4 73.63 L -134.91 74.11 L -136.88 74.63 L -139.31 75.14 L -142.22 75.57 L -145.6 75.89 L -149.44 76.04 L -153.74 75.97 L -158.48 75.64 L -163.64 74.98 L -168.73 62.69 L -165.54 58.58 L -162.43 54.99 L -159.44 51.9 L -156.62 49.29 L -154 47.13 L -151.64 45.38 L -149.56 44.01 L -147.8 42.99 L -146.39 42.27 L -145.36 41.81 L -144.73 41.57 L -144.51 41.5 A 8 8 0 0 0 -149.39 16.97 L -149.62 16.98 L -150.29 17 L -151.42 16.97 L -153 16.85 L -155.02 16.57 L -157.46 16.1 L -160.32 15.39 L -163.56 14.39 L -167.17 13.06 L -171.11 11.35 L -175.36 9.23 L -179.88 6.66 L -179.88 -6.66 L -175.36 -9.23 L -171.11 -11.35 L -167.17 -13.06 L -163.56 -14.39 L -160.32 -15.39 L -157.46 -16.1 L -155.02 -16.57 L -153 -16.85 L -151.42 -16.97 L -150.29 -17 L -149.62 -16.98 L -149.39 -16.97 A 8 8 0 0 0 -144.51 -41.5 L -144.73 -41.57 L -145.36 -41.81 L -146.39 -42.27 L -147.8 -42.99 L -149.56 -44.01 L -151.64 -45.38 L -154 -47.13 L -156.62 -49.29 L -159.44 -51.9 L -162.43 -54.99 L -165.54 -58.58 L -168.73 -62.69 L -163.64 -74.98 L -158.48 -75.64 L -153.74 -75.97 L -149.44 -76.04 L -145.6 -75.89 L -142.22 -75.57 L -139.31 -75.14 L -136.88 -74.63 L -134.91 -74.11 L -133.4 -73.63 L -132.35 -73.22 L -131.73 -72.95 L -131.53 -72.84 A 8 8 0 0 0 -117.63 -93.64 L -117.8 -93.79 L -118.3 -94.25 L -119.07 -95.07 L -120.1 -96.28 L -121.33 -97.9 L -122.73 -99.96 L -124.24 -102.48 L -125.83 -105.48 L -127.44 -108.97 L -129.02 -112.96 L -130.52 -117.47 L -131.9 -122.49 L -122.49 -131.9 L -117.47 -130.52 L -112.96 -129.02 L -108.97 -127.44 L -105.48 -125.83 L -102.48 -124.24 L -99.96 -122.73 L -97.9 -121.33 L -96.28 -120.1 L -95.07 -119.07 L -94.25 -118.3 L -93.79 -117.8 L -93.64 -117.63 A 8 8 0 0 0 -72.84 -131.53 L -72.95 -131.73 L -73.22 -132.35 L -73.63 -133.4 L -74.11 -134.91 L -74.63 -136.88 L -75.14 -139.31 L -75.57 -142.22 L -75.89 -145.6 L -76.04 -149.44 L -75.97 -153.74 L -75.64 -158.48 L -74.98 -163.64 L -62.69 -168.73 L -58.58 -165.54 L -54.99 -162.43 L -51.9 -159.44 L -49.29 -156.62 L -47.13 -154 L -45.38 -151.64 L -44.01 -149.56 L -42.99 -147.8 L -42.27 -146.39 L -41.81 -145.36 L -41.57 -144.73 L -41.5 -144.51 A 8 8 0 0 0 -16.97 -149.39 L -16.98 -149.62 L -17 -150.29 L -16.97 -151.42 L -16.85 -153 L -16.57 -155.02 L -16.1 -157.46 L -15.39 -160.32 L -14.39 -163.56 L -13.06 -167.17 L -11.35 -171.11 L -9.23 -175.36 L -6.66 -179.88 L 6.66 -179.88 L 9.23 -175.36 L 11.35 -171.11 L 13.06 -167.17 L 14.39 -163.56 L 15.39 -160.32 L 16.1 -157.46 L 16.57 -155.02 L 16.85 -153 L 16.97 -151.42 L 17 -150.29 L 16.98 -149.62 L 16.97 -149.39 A 8 8 0 0 0 41.5 -144.51 L 41.57 -144.73 L 41.81 -145.36 L 42.27 -146.39 L 42.99 -147.8 L 44.01 -149.56 L 45.38 -151.64 L 47.13 -154 L 49.29 -156.62 L 51.9 -159.44 L 54.99 -162.43 L 58.58 -165.54 L 62.69 -168.73 L 74.98 -163.64 L 75.64 -158.48 L 75.97 -153.74 L 76.04 -149.44 L 75.89 -145.6 L 75.57 -142.22 L 75.14 -139.31 L 74.63 -136.88 L 74.11 -134.91 L 73.63 -133.4 L 73.22 -132.35 L 72.95 -131.73 L 72.84 -131.53 A 8 8 0 0 0 93.64 -117.63 L 93.79 -117.8 L 94.25 -118.3 L 95.07 -119.07 L 96.28 -120.1 L 97.9 -121.33 L 99.96 -122.73 L 102.48 -124.24 L 105.48 -125.83 L 108.97 -127.44 L 112.96 -129.02 L 117.47 -130.52 L 122.49 -131.9 L 131.9 -122.49 L 130.52 -117.47 L 129.02 -112.96 L 127.44 -108.97 L 125.83 -105.48 L 124.24 -102.48 L 122.73 -99.96 L 121.33 -97.9 L 120.1 -96.28 L 119.07 -95.07 L 118.3 -94.25 L 117.8 -93.79 L 117.63 -93.64 A 8 8 0 0 0 131.53 -72.84 L 131.73 -72.95 L 132.35 -73.22 L 133.4 -73.63 L 134.91 -74.11 L 136.88 -74.63 L 139.31 -75.14 L 142.22 -75.57 L 145.6 -75.89 L 149.44 -76.04 L 153.74 -75.97 L 158.48 -75.64 L 163.64 -74.98 L 168.73 -62.69 L 165.54 -58.58 L 162.43 -54.99 L 159.44 -51.9 L 156.62 -49.29 L 154 -47.13 L 151.64 -45.38 L 149.56 -44.01 L 147.8 -42.99 L 146.39 -42.27 L 145.36 -41.81 L 144.73 -41.57 L 144.51 -41.5 A 8 8 0 0 0 149.39 -16.97 L 149.62 -16.98 L 150.29 -17 L 151.42 -16.97 L 153 -16.85 L 155.02 -16.57 L 157.46 -16.1 L 160.32 -15.39 L 163.56 -14.39 L 167.17 -13.06 L 171.11 -11.35 L 175.36 -9.23 L 179.88 -6.66 L 179.88 6.66 L 175.36 9.23 L 171.11 11.35 L 167.17 13.06 L 163.56 14.39 L 160.32 15.39 L 157.46 16.1 L 155.02 16.57 L 153 16.85 L 151.42 16.97 L 150.29 17 L 149.62 16.98 L 149.39 16.97
			  M -110 0
				a 110 110 0 1 0 220 0
				a 110 110 0 1 0 -220 0
			" mask="url(#wedge-mask)" stroke="none" stroke-width="4"></path><circle cx="0" cy="0" r="60" stroke="none"></circle><path d="
						M 0 0
						L 0 40
						L 160 20
						A 0.2 1 0 0 0 160 -20
						L 0 -40
						z
					"></path></g></svg>Crank.js</a></div><div><a href="/guides/getting-started">Guides</a></div><div><a href="/blog/">Blog</a></div><div><a href="/playground/" aria-current="page">Playground</a></div></div><div class="css-1n0j5y9"><div><a href="https://github.com/bikeshaving/crank">GitHub</a></div><div><a href="http://npm.im/@b9g/crank">NPM</a></div><button role="switch" aria-label="set dark mode" aria-checked="false">⬜</button></div></nav></div><div id="playground"></div><script data-name="embedded-json-9" id="examples">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['embedded-json-9'] = [{"name":"timer","label":"Timer","code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction *Timer() {\n  let seconds = 0;\n  const interval = setInterval(() =\u003E {\n    seconds++;\n    this.refresh();\n  }, 1000);\n\n  for ({} of this) {\n    yield \u003Cdiv\u003E{seconds}\u003C\u002Fdiv\u003E;\n  }\n\n  clearInterval(interval);\n}\n\nrenderer.render(\u003CTimer \u002F\u003E, document.body);"},{"name":"wizard","label":"Form Wizard","code":"import {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nfunction* Wizard() {\n  let step = 0;\n  const formData = new FormData();\n  this.addEventListener(\"submit\", (ev) =\u003E {\n    const isValid = ev.target.reportValidity();\n    if (isValid) {\n      ev.preventDefault();\n      const data = new FormData(ev.target);\n      for (const [key, value] of data) {\n        formData.append(key, value);\n      }\n\n      \u002F\u002F Code to handle form submission\n      step++;\n      this.refresh();\n    }\n  });\n\n  for ({} of this) {\n    yield (\n      \u003Cform $key={step}\u003E\n        {step === 0 ? (\n          \u003C\u003E\n            \u003Clabel for=\"name\"\u003EName:\u003C\u002Flabel\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cinput name=\"name\" type=\"text\" required \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Clabel for=\"email\"\u003EEmail:\u003C\u002Flabel\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cinput name=\"email\" type=\"email\" required \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cbutton type=\"submit\"\u003ENext\u003C\u002Fbutton\u003E\n          \u003C\u002F\u003E\n        ) : step === 1 ? (\n          \u003C\u003E\n            \u003Clabel for=\"profile\"\u003EProfile:\u003C\u002Flabel\u003E\n            \u003Cbr \u002F\u003E\n            \u003Ctextarea name=\"profile\" required \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Clabel for=\"avatar\"\u003EAvatar:\u003C\u002Flabel\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cinput name=\"avatar\" type=\"file\" \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cbr \u002F\u003E\n            \u003Cbutton type=\"submit\"\u003ESubmit\u003C\u002Fbutton\u003E\n          \u003C\u002F\u003E\n        ) : (\n          \u003Cpre\u003E{JSON.stringify(Object.fromEntries(formData), null, 2)}\u003C\u002Fpre\u003E\n        )}\n      \u003C\u002Fform\u003E\n    );\n  }\n}\n\nrenderer.render(\u003CWizard \u002F\u003E, document.body);\n"},{"name":"tetris","label":"Tetris","code":"import {jsx} from \"@b9g\u002Fcrank\u002Fstandalone\";\nimport {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\n\u002F\u002F tetronimo shapes represented as 2d arrays\ntype Tet = number[][];\nconst tets: Record\u003Cstring, Tet\u003E = {\n  I: [\n    [0, 0, 0, 0],\n    [1, 1, 1, 1],\n    [0, 0, 0, 0],\n    [0, 0, 0, 0],\n  ],\n  O: [\n    [1, 1],\n    [1, 1],\n  ],\n  T: [\n    [0, 1, 0],\n    [1, 1, 1],\n    [0, 0, 0],\n  ],\n  J: [\n    [0, 0, 1],\n    [1, 1, 1],\n    [0, 0, 0],\n  ],\n  L: [\n    [1, 0, 0],\n    [1, 1, 1],\n    [0, 0, 0],\n  ],\n  S: [\n    [0, 1, 1],\n    [1, 1, 0],\n    [0, 0, 0],\n  ],\n  Z: [\n    [1, 1, 0],\n    [0, 1, 1],\n    [0, 0, 0],\n  ],\n};\n\nfunction randomTet() {\n  const tetValues = Array.from(Object.values(tets));\n  return tetValues[Math.floor(Math.random() * tetValues.length)];\n}\n\nfunction transpose(tet: Tet): Tet {\n  return tet.map((row, r) =\u003E row.map((cell, c) =\u003E tet[c][r]));\n}\n\nfunction reflectY(tet: Tet): Tet {\n  return tet.map((row, r) =\u003E row.map((cell, c) =\u003E tet[tet.length - r - 1][c]));\n}\n\n\u002F\u002F TODO: combine rotate90 and rotate270\nfunction rotate90(tet: Tet): Tet {\n  return reflectY(transpose(tet));\n}\n\nfunction rotate270(tet: Tet): Tet {\n  return transpose(reflectY(tet));\n}\n\ninterface Piece {\n  tet: Tet;\n  x: number;\n  y: number;\n}\n\n\u002F\u002F SVG coordinates, so top row is 0 and bottom row is field.length - 1;\ntype Field = number[][];\n\nfunction canFit(piece: Piece, field: Field): boolean {\n  for (const [c, r] of squaresOf(piece)) {\n    if (r \u003C 0) {\n      \u002F\u002F square is above the board\n      return false;\n    } else if (r \u003E= field.length) {\n      \u002F\u002F square is below the board\n      return false;\n    } else if (c \u003C 0) {\n      \u002F\u002F square is left of board\n      return false;\n    } else if (c \u003E= field[0].length) {\n      \u002F\u002F square is right of board\n      return false;\n    } else if (field[r][c]) {\n      \u002F\u002F square is occupied\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction squaresOf(piece: Piece): [x: number, y: number][] {\n  const squares = [];\n  for (let r = 0; r \u003C piece.tet.length; r++) {\n    const row = piece.tet[r];\n    for (let c = 0; c \u003C row.length; c++) {\n      const data = row[c];\n      if (data) {\n        squares.push([c + piece.x, r + piece.y]);\n      }\n    }\n  }\n\n  return squares;\n}\n\nfunction createPiece(): Piece {\n  \u002F\u002F TODO: piece sequences\n  return {\n    tet: randomTet(),\n    x: 3,\n    y: 0,\n  };\n}\n\nfunction placePiece(piece: Piece, field: Field) {\n  for (const [c, r] of squaresOf(piece)) {\n    field[r][c] = true;\n  }\n\n  clearFilledRows(field);\n}\n\nfunction clearFilledRows(field: Field) {\n  for (let r = 0; r \u003C field.length; r++) {\n    const row = field[r];\n    if (row.every((d) =\u003E d)) {\n      \u002F\u002F copy previous rows into next rows\n      for (let r1 = r; r1 \u003E 0; r1--) {\n        field[r1] = field[r1 - 1];\n      }\n\n      \u002F\u002F clear the top row\n      field[0] = field[0].map(() =\u003E false);\n    }\n  }\n}\n\nconst UNIT = 20;\nconst WIDTH = 10;\nconst HEIGHT = 24;\n\nfunction Piece({piece}) {\n  \u002F\u002F TODO: colored pieces\n  return jsx`\n    \u003Cg fill=\"red\"\u003E\n      ${squaresOf(piece).map(\n        ([c, r]) =\u003E jsx`\n        \u003Crect\n          width=${UNIT}\n          height=${UNIT}\n          transform=\"translate(${c * UNIT}, ${r * UNIT})\"\n        \u002F\u003E\n      `,\n      )}\n    \u003C\u002Fg\u003E\n  `;\n}\n\nfunction Board({field}) {\n  return field.map((row, r) =\u003E\n    row.map(\n      (data, c) =\u003E jsx`\n      \u003Crect\n        width=${UNIT}\n        height=${UNIT}\n        fill=${data && \"blue\"}\n        x=${c * UNIT}\n        y=${r * UNIT}\n      \u002F\u003E\n    `,\n    ),\n  );\n}\n\nfunction* App() {\n  let currentPiece = createPiece();\n  const field = Array.from(Array(HEIGHT), () =\u003E\n    Array.from(Array(WIDTH), () =\u003E false),\n  );\n\n  const interval = setInterval(() =\u003E {\n    currentPiece.y++;\n    if (!canFit(currentPiece, field)) {\n      currentPiece.y--;\n      placePiece(currentPiece, field);\n      \u002F\u002F TODO: game over check\n      currentPiece = createPiece();\n    }\n    this.refresh();\n  }, 1000);\n  this.cleanup(() =\u003E clearInterval(interval));\n\n  const keydown = (ev) =\u003E {\n    if (ev.key === \"w\") {\n      \u002F\u002F rotate left\n      \u002F\u002F TODO: wall kicks to allow rotations at the edge\n      currentPiece.tet = rotate90(currentPiece.tet);\n      if (!canFit(currentPiece, field)) {\n        currentPiece.tet = rotate270(currentPiece.tet);\n      }\n    } else if (ev.key === \"e\") {\n      \u002F\u002F rotate right\n      \u002F\u002F TODO: wall kicks to allow rotations at the edge\n      currentPiece.tet = rotate270(currentPiece.tet);\n      if (!canFit(currentPiece, field)) {\n        currentPiece.tet = rotate90(currentPiece.tet);\n      }\n    } else if (ev.key === \"a\") {\n      \u002F\u002F move left\n      currentPiece.x--;\n      if (!canFit(currentPiece, field)) {\n        currentPiece.x++;\n      }\n    } else if (ev.key === \"s\") {\n      \u002F\u002F move down\n      currentPiece.y++;\n      if (!canFit(currentPiece, field)) {\n        currentPiece.y--;\n        placePiece(currentPiece, field);\n        currentPiece = createPiece();\n      }\n    } else if (ev.key === \"d\") {\n      \u002F\u002F move right\n      currentPiece.x++;\n      if (!canFit(currentPiece, field)) {\n        currentPiece.x--;\n      }\n    }\n\n    \u002F\u002F TODO: hard drop\n    this.refresh();\n  };\n\n  window.addEventListener(\"keydown\", keydown);\n  this.cleanup(() =\u003E window.removeEventListener(\"keydown\", keydown));\n\n  for ({} of this) {\n    \u002F\u002F TODO: game start\u002Fgame over\n    \u002F\u002F TODO: piece placement preview\n    \u002F\u002F TODO: next piece\n    yield jsx`\n      \u003Csvg\n        width=${WIDTH * UNIT}\n        height=${HEIGHT * UNIT}\n        style=\"border: 1px solid currentcolor\"\n        fill=\"transparent\"\n      \u003E\n        \u003C${Board} field=${field} \u002F\u003E\n        \u003C${Piece} piece=${currentPiece} \u002F\u003E\n      \u003C\u002Fsvg\u003E\n    `;\n  }\n}\n\nrenderer.render(jsx`\u003C${App} \u002F\u003E`, document.body);\n"},{"name":"calculator","label":"XState Calculator","code":"\u002F\u002F Based on xstate-vue-calculator:\n\u002F\u002F https:\u002F\u002Fgithub.com\u002FGlutnix\u002Fxstate-vue-calculator\n\u002F\u002F Can't import from \"xstate\":\n\u002F\u002F https:\u002F\u002Fgithub.com\u002Fstatelyai\u002Fxstate\u002Fpull\u002F2318#issuecomment-864795216\nimport {Machine, assign} from \"xstate@4\u002Fdist\u002Fxstate.web.js\";\nimport {Context, createElement} from \"@b9g\u002Fcrank\";\nimport {renderer} from \"@b9g\u002Fcrank\u002Fdom\";\n\nconst not =\n  (fn) =\u003E\n  (...args) =\u003E\n    !fn.apply(null, args);\nconst isZero = (context, event) =\u003E event.key === 0;\nconst isNotZero = not(isZero);\nconst isMinus = (context, event) =\u003E event.operator === \"-\";\nconst isNotMinus = not(isMinus);\nconst divideByZero = (context) =\u003E\n  context.operand2 === \"0.\" && context.operator === \"\u002F\";\nconst notDivideByZero = not(divideByZero);\n\nfunction doMath(operand1, operand2, operator) {\n  switch (operator) {\n    case \"+\":\n      return +operand1 + +operand2;\n    case \"-\":\n      return +operand1 - +operand2;\n    case \"\u002F\":\n      return +operand1 \u002F +operand2;\n    case \"x\":\n      return +operand1 * +operand2;\n    default:\n      return Infinity;\n  }\n}\n\nexport const calcMachine = Machine(\n  {\n    id: \"calcMachine\",\n    context: {\n      display: \"0.\",\n      operand1: null,\n      operand2: null,\n      operator: null,\n    },\n    \u002F\u002F strict: true,\n    on: {\n      CLEAR_EVERYTHING: {\n        target: \".start\",\n        actions: [\"reset\"],\n      },\n    },\n    initial: \"start\",\n    states: {\n      start: {\n        on: {\n          NUMBER: [\n            {\n              cond: \"isZero\",\n              target: \"operand1.zero\",\n              actions: [\"defaultReadout\"],\n            },\n            {\n              cond: \"isNotZero\",\n              target: \"operand1.before_decimal_point\",\n              actions: [\"setReadoutNum\"],\n            },\n          ],\n          OPERATOR: {\n            cond: \"isMinus\",\n            target: \"negative_number\",\n            actions: [\"startNegativeNumber\"],\n          },\n          DECIMAL_POINT: {\n            target: \"operand1.after_decimal_point\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n      },\n      operand1: {\n        on: {\n          OPERATOR: {\n            target: \"operator_entered\",\n            actions: [\"recordOperator\"],\n          },\n          PERCENTAGE: {\n            target: \"result\",\n            actions: [\"storeResultAsOperand2\", \"computePercentage\"],\n          },\n          CLEAR_ENTRY: {\n            target: \"operand1\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n        initial: \"zero\",\n        states: {\n          zero: {\n            on: {\n              NUMBER: {\n                target: \"before_decimal_point\",\n                actions: [\"setReadoutNum\"],\n              },\n              DECIMAL_POINT: \"after_decimal_point\",\n            },\n          },\n          before_decimal_point: {\n            on: {\n              NUMBER: {\n                target: \"before_decimal_point\",\n                actions: [\"appendNumBeforeDecimal\"],\n              },\n              DECIMAL_POINT: \"after_decimal_point\",\n            },\n          },\n          after_decimal_point: {\n            on: {\n              NUMBER: {\n                target: \"after_decimal_point\",\n                actions: [\"appendNumAfterDecimal\"],\n              },\n            },\n          },\n        },\n      },\n      negative_number: {\n        on: {\n          NUMBER: [\n            {\n              cond: \"isZero\",\n              target: \"operand1.zero\",\n              actions: [\"defaultNegativeReadout\"],\n            },\n            {\n              cond: \"isNotZero\",\n              target: \"operand1.before_decimal_point\",\n              actions: [\"setNegativeReadoutNum\"],\n            },\n          ],\n          DECIMAL_POINT: {\n            target: \"operand1.after_decimal_point\",\n            actions: [\"defaultNegativeReadout\"],\n          },\n          CLEAR_ENTRY: {\n            target: \"start\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n      },\n      operator_entered: {\n        on: {\n          OPERATOR: [\n            {\n              cond: \"isNotMinus\",\n              target: \"operator_entered\",\n              actions: [\"setOperator\"],\n            },\n            {\n              cond: \"isMinus\",\n              target: \"negative_number_2\",\n              actions: [\"startNegativeNumber\"],\n            },\n          ],\n          NUMBER: [\n            {\n              cond: \"isZero\",\n              target: \"operand2.zero\",\n              actions: [\"defaultReadout\"],\n            },\n            {\n              cond: \"isNotZero\",\n              target: \"operand2.before_decimal_point\",\n              actions: [\"setReadoutNum\"],\n            },\n          ],\n          DECIMAL_POINT: {\n            target: \"operand2.after_decimal_point\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n      },\n      operand2: {\n        on: {\n          OPERATOR: {\n            target: \"operator_entered\",\n            actions: [\n              \"storeResultAsOperand2\",\n              \"compute\",\n              \"storeResultAsOperand1\",\n              \"setOperator\",\n            ],\n          },\n          EQUALS: [\n            {\n              cond: \"notDivideByZero\",\n              target: \"result\",\n              actions: [\"storeResultAsOperand2\", \"compute\"],\n            },\n            {target: \"alert\", actions: [\"divideByZeroAlert\"]},\n          ],\n          CLEAR_ENTRY: {\n            target: \"operand2\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n        initial: \"hist\",\n        states: {\n          hist: {\n            type: \"history\",\n            target: \"zero\",\n          },\n          zero: {\n            on: {\n              NUMBER: {\n                target: \"before_decimal_point\",\n                actions: [\"setReadoutNum\"],\n              },\n              DECIMAL_POINT: \"after_decimal_point\",\n            },\n          },\n          before_decimal_point: {\n            on: {\n              NUMBER: {\n                target: \"before_decimal_point\",\n                actions: [\"appendNumBeforeDecimal\"],\n              },\n              DECIMAL_POINT: \"after_decimal_point\",\n            },\n          },\n          after_decimal_point: {\n            on: {\n              NUMBER: {\n                target: \"after_decimal_point\",\n                actions: [\"appendNumAfterDecimal\"],\n              },\n            },\n          },\n        },\n      },\n      negative_number_2: {\n        on: {\n          NUMBER: [\n            {\n              cond: \"isZero\",\n              target: \"operand2.zero\",\n              actions: [\"defaultNegativeReadout\"],\n            },\n            {\n              cond: \"isNotZero\",\n              target: \"operand2.before_decimal_point\",\n              actions: [\"setNegativeReadoutNum\"],\n            },\n          ],\n          DECIMAL_POINT: {\n            target: \"operand2.after_decimal_point\",\n            actions: [\"defaultNegativeReadout\"],\n          },\n          CLEAR_ENTRY: {\n            target: \"operator_entered\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n      },\n      result: {\n        on: {\n          NUMBER: [\n            {\n              cond: \"isZero\",\n              target: \"operand1\",\n              actions: [\"defaultReadout\"],\n            },\n            {\n              cond: \"isNotZero\",\n              target: \"operand1.before_decimal_point\",\n              actions: [\"setReadoutNum\"],\n            },\n          ],\n          PERCENTAGE: {\n            target: \"result\",\n            actions: [\"storeResultAsOperand2\", \"computePercentage\"],\n          },\n          OPERATOR: {\n            target: \"operator_entered\",\n            actions: [\"storeResultAsOperand1\", \"recordOperator\"],\n          },\n          CLEAR_ENTRY: {\n            target: \"start\",\n            actions: [\"defaultReadout\"],\n          },\n        },\n      },\n      alert: {\n        on: {\n          OK: \"operand2.hist\",\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isMinus,\n      isNotMinus,\n      isZero,\n      isNotZero,\n      notDivideByZero,\n    },\n    actions: {\n      defaultReadout: assign({\n        display: () =\u003E \"0.\",\n      }),\n\n      defaultNegativeReadout: assign({\n        display: () =\u003E \"-0.\",\n      }),\n\n      appendNumBeforeDecimal: assign({\n        display: (context, event) =\u003E\n          context.display.slice(0, -1) + event.key + \".\",\n      }),\n\n      appendNumAfterDecimal: assign({\n        display: (context, event) =\u003E context.display + event.key,\n      }),\n\n      setReadoutNum: assign({\n        display: (context, event) =\u003E event.key + \".\",\n      }),\n\n      setNegativeReadoutNum: assign({\n        display: (context, event) =\u003E \"-\" + event.key + \".\",\n      }),\n\n      startNegativeNumber: assign({\n        display: () =\u003E \"-\",\n      }),\n\n      recordOperator: assign({\n        operand1: (context) =\u003E context.display,\n        operator: (_, event) =\u003E event.operator,\n      }),\n\n      setOperator: assign({\n        operator: ({operator}) =\u003E operator,\n      }),\n\n      computePercentage: assign({\n        display: (context) =\u003E context.display \u002F 100,\n      }),\n\n      compute: assign({\n        display: ({operand1, operand2, operator}) =\u003E\n          doMath(operand1, operand2, operator),\n      }),\n\n      storeResultAsOperand1: assign({\n        operand1: (context) =\u003E context.display,\n      }),\n\n      storeResultAsOperand2: assign({\n        operand2: (context) =\u003E context.display,\n      }),\n\n      divideByZeroAlert() {\n        \u002F\u002F have to put the alert in setTimeout because action is executed on event, before the transition to next state happens\n        \u002F\u002F this alert is supposed to happend on transition\n        \u002F\u002F setTimeout allows time for other state transition (to 'alert' state) to happen before showing the alert\n        \u002F\u002F probably a better way to do it. like entry or exit actions\n        setTimeout(() =\u003E {\n          alert(\"Cannot divide by zero!\");\n          this.transition(\"OK\");\n        }, 0);\n      },\n\n      reset: assign({\n        display: () =\u003E \"0.\",\n        operand1: () =\u003E null,\n        operand2: () =\u003E null,\n        operator: () =\u003E null,\n      }),\n    },\n  },\n);\n\nconst buttonLabels = [\n  \"C\",\n  \"CE\",\n  \"\u002F\",\n  \"7\",\n  \"8\",\n  \"9\",\n  \"x\",\n  \"4\",\n  \"5\",\n  \"6\",\n  \"-\",\n  \"1\",\n  \"2\",\n  \"3\",\n  \"+\",\n  \"0\",\n  \".\",\n  \"=\",\n  \"%\",\n];\n\nfunction isOperator(label: string): boolean {\n  return \"+-x\u002F\".indexOf(label) \u003E -1;\n}\n\nfunction buttonDescription(label: string): string {\n  if (Number.isInteger(+label)) return `NUMBER ${label}`;\n  if (isOperator(label)) return `OPERATOR ${label}`;\n  if (label === \"C\") return \"CLEAR_EVERYTHING\";\n  if (label === \"CE\") return \"CLEAR_ENTRY\";\n  if (label === \".\") return \"DECIMAL_POINT\";\n  if (label === \"%\") return \"PERCENTAGE\";\n  if (label === \"=\") return \"EQUALS\";\n  return \"\";\n}\n\nfunction* Calculator(this: Context) {\n  let state = calcMachine.initialState;\n  this.addEventListener(\"click\", (el) =\u003E {\n    if ((el.target as Element).tagName === \"BUTTON\") {\n      \u002F\u002F TODO: could this be abstracted somehow :-)\n      const label = (el.target as Element).textContent!;\n      if (Number.isInteger(+label)) {\n        state = calcMachine.transition(state, {type: \"NUMBER\", key: +label});\n      } else if (isOperator(label)) {\n        state = calcMachine.transition(state, {\n          type: \"OPERATOR\",\n          operator: label,\n        });\n      } else if (label === \"C\") {\n        state = calcMachine.transition(state, {type: \"CLEAR_EVERYTHING\"});\n      } else if (label === \".\") {\n        state = calcMachine.transition(state, {type: \"DECIMAL_POINT\"});\n      } else if (label === \"=\") {\n        state = calcMachine.transition(state, {type: \"EQUALS\"});\n      } else if (label === \"%\") {\n        state = calcMachine.transition(state, {type: \"PERCENTAGE\"});\n      } else if (label === \"CE\") {\n        state = calcMachine.transition(state, {type: \"CLEAR_ENTRY\"});\n      }\n      this.refresh();\n    }\n  });\n\n  for ({} of this) {\n    yield (\n      \u003Cdiv id=\"app\"\u003E\n        \u003Cdiv class=\"container\"\u003E\n          \u003Cinput class=\"readout\" disabled value={state.context.display} \u002F\u003E\n          \u003Cdiv class=\"button-grid\"\u003E\n            {buttonLabels.map((b) =\u003E (\n              \u003Cbutton\n                class={\"calc-button\" + (b === \"C\" ? \" two-span\" : \"\")}\n                title={buttonDescription(b)}\n              \u003E\n                {b}\n              \u003C\u002Fbutton\u003E\n            ))}\n          \u003C\u002Fdiv\u003E\n        \u003C\u002Fdiv\u003E\n        {\u002F* Uncomment to debug\n        \u003Cdiv class=\"debug\"\u003E\n          \u003Clabel\u003EState:\u003C\u002Flabel\u003E\n          \u003Cpre\u003E\n            \u003Ccode\u003E{JSON.stringify(state.value, null, 2)}\u003C\u002Fcode\u003E\n          \u003C\u002Fpre\u003E\n          \u003Clabel\u003EContext:\u003C\u002Flabel\u003E\n          \u003Cpre\u003E\n            \u003Ccode\u003E{JSON.stringify(state.context, null, 2)}\u003C\u002Fcode\u003E\n          \u003C\u002Fpre\u003E\n        \u003C\u002Fdiv\u003E\n        *\u002F}\n      \u003C\u002Fdiv\u003E\n    );\n  }\n}\n\nconst style = document.createElement(\"style\");\nstyle.textContent = `\n.container {\n  max-width: 300px;\n  margin: 0 auto;\n  border: 2px solid gray;\n  border-radius: 4px;\n  box-sizing: border-box;\n}\n.readout {\n  font-size: 32px;\n  color: #333;\n  text-align: right;\n  padding: 5px 13px;\n  width: 100%;\n  border: none;\n  border-bottom: 1px solid gray;\n  box-sizing: border-box;\n}\n.button-grid {\n  display: grid;\n  padding: 20px;\n  grid-template-columns: repeat(4, 1fr);\n  grid-gap: 15px;\n}\n.calc-button {\n  padding: 10px;\n  font-size: 22px;\n  color: #eee;\n  background: rgba(0, 0, 0, 0.5);\n  cursor: pointer;\n  border-radius: 2px;\n  border: 0;\n  outline: none;\n  opacity: 0.8;\n  transition: opacity 0.2s ease-in-out;\n}\n.calc-button:hover {\n  opacity: 1;\n}\n.calc-button:active {\n  background: #999;\n  box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.6);\n}\n.two-span {\n  grid-column: span 2;\n  background-color: #3572db;\n}\n`;\ndocument.head.appendChild(style);\n\nrenderer.render(\u003CCalculator \u002F\u003E, document.body);\n"}];
		</script><script src="/static/playground-5O4Q37B4.js" type="module"></script><script data-name="static-urls-10" id="static-urls">
			if (window.__embeddedJSON__ == null) {
				window.__embeddedJSON__ = {};
			}
			window.__embeddedJSON__['static-urls-10'] = {"@b9g\u002Fcrank":"\u002Fstatic\u002Fcrank-IKBCNXHY.js","@b9g\u002Fcrank\u002Fcrank":"\u002Fstatic\u002Fcrank-IKBCNXHY.js","@b9g\u002Fcrank\u002Fcrank.js":"\u002Fstatic\u002Fcrank-IKBCNXHY.js","@b9g\u002Fcrank\u002Fdom":"\u002Fstatic\u002Fdom-P6RTISBD.js","@b9g\u002Fcrank\u002Fdom.js":"\u002Fstatic\u002Fdom-P6RTISBD.js","@b9g\u002Fcrank\u002Fhtml":"\u002Fstatic\u002Fhtml-BAPPTV5D.js","@b9g\u002Fcrank\u002Fhtml.js":"\u002Fstatic\u002Fhtml-BAPPTV5D.js","@b9g\u002Fcrank\u002Fjsx-tag":"\u002Fstatic\u002Fjsx-tag-LOQQR4CC.js","@b9g\u002Fcrank\u002Fjsx-tag.js":"\u002Fstatic\u002Fjsx-tag-LOQQR4CC.js","@b9g\u002Fcrank\u002Fjsx-runtime":"\u002Fstatic\u002Fjsx-runtime-TBBD57QJ.js","@b9g\u002Fcrank\u002Fjsx-runtime.js":"\u002Fstatic\u002Fjsx-runtime-TBBD57QJ.js","@b9g\u002Fcrank\u002Fstandalone":"\u002Fstatic\u002Fstandalone-2WFTNLZJ.js","@b9g\u002Fcrank\u002Fstandalone.js":"\u002Fstatic\u002Fstandalone-2WFTNLZJ.js","client.css":"\u002Fstatic\u002Fclient-TNOPHTVT.css"};
		</script><script src="/static/navbar-FAMV3XX3.js"></script><script src="/static/code-blocks-SV5MHPTG.js"></script></body></html>